<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ”® GACHA ORACLE â€” éœŠçœ¼çµ±åˆå è¡“ã‚·ã‚¹ãƒ†ãƒ </title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300;1,400&family=Cinzel:wght@400;600;700&family=Noto+Serif+JP:wght@300;400;700&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DESIGN TOKENS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --void:    #07040E;
  --deep:    #0F0820;
  --well:    #160C2E;
  --rim:     rgba(255,255,255,.07);
  --glass:   rgba(255,255,255,.034);
  --gold:    #C9A84C;
  --gold-l:  #EDD070;
  --gold-d:  #7A5518;
  --iris:    #8B5CF6;
  --iris-l:  #A78BFA;
  --rose:    #E05585;
  --ice:     #38BDF8;
  --green:   #34D399;
  --text:    #EDE6F5;
  --muted:   #6E5F88;
  --danger:  #F87171;
  --r:       18px;
}

*, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }
html { scroll-behavior: smooth; }

body {
  font-family: 'Noto Serif JP', serif;
  background: var(--void);
  color: var(--text);
  min-height: 100vh;
  overflow-x: hidden;
}

/* â”€â”€ Layered background â”€â”€ */
.bg-nebula {
  position: fixed; inset: 0; pointer-events: none; z-index: 0;
  background:
    radial-gradient(ellipse 65% 55% at 15% 10%, rgba(80,30,160,.22) 0%, transparent 60%),
    radial-gradient(ellipse 45% 45% at 85% 85%, rgba(201,168,76,.10) 0%, transparent 55%),
    radial-gradient(ellipse 35% 35% at 55% 40%, rgba(139,92,246,.07) 0%, transparent 50%);
}

/* grain texture */
.grain {
  position: fixed; inset: 0; pointer-events: none; z-index: 1; opacity: .22;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='200'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.8' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='200' height='200' filter='url(%23n)'/%3E%3C/svg%3E");
}

canvas#cosmos { position:fixed; inset:0; pointer-events:none; z-index:0; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LAYOUT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.wrap { position:relative; z-index:2; max-width:760px; margin:0 auto; padding:0 18px 100px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HEADER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.hdr {
  text-align:center; padding:72px 0 52px;
  animation: riseIn 1.2s cubic-bezier(.16,1,.3,1) both;
}

.hdr-sigil {
  font-size:3.4rem; display:block; margin-bottom:18px;
  filter: drop-shadow(0 0 28px rgba(201,168,76,.75));
  animation: float 4s ease-in-out infinite;
}
@keyframes float { 0%,100%{transform:translateY(0) rotate(0deg)} 50%{transform:translateY(-14px) rotate(4deg)} }

.hdr h1 {
  font-family:'Cinzel',serif;
  font-size: clamp(1.5rem, 5.5vw, 2.9rem);
  font-weight:700; letter-spacing:.16em; line-height:1.18;
  background: linear-gradient(135deg, #A78BFA 0%, #EDD070 48%, #E05585 100%);
  -webkit-background-clip:text; -webkit-text-fill-color:transparent;
  background-clip:text;
  filter: drop-shadow(0 0 40px rgba(201,168,76,.28));
  margin-bottom:12px;
}
.hdr-sub {
  font-family:'Cormorant Garamond',serif; font-style:italic;
  font-size:1rem; color:var(--muted); letter-spacing:.14em;
}
.hdr-tags {
  margin-top:14px; display:flex; justify-content:center; gap:10px; flex-wrap:wrap;
}
.hdr-tag {
  font-family:'Cinzel',serif; font-size:.58rem; letter-spacing:.18em;
  color:var(--gold); border:1px solid rgba(201,168,76,.25);
  border-radius:20px; padding:4px 12px; text-transform:uppercase;
  background:rgba(201,168,76,.06);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GLASS CARDS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.glass {
  background:var(--glass);
  backdrop-filter:blur(22px); -webkit-backdrop-filter:blur(22px);
  border:1px solid var(--rim);
  border-radius:var(--r);
  padding:36px;
  margin-bottom:18px;
  position:relative; overflow:hidden;
  animation: riseIn .8s cubic-bezier(.16,1,.3,1) both;
}
.glass::before {
  content:''; position:absolute; top:0; left:0; right:0; height:1px;
  background:linear-gradient(90deg, transparent 0%, var(--iris-l) 30%, var(--gold) 60%, var(--rose) 85%, transparent 100%);
  opacity:.55;
}

@keyframes riseIn { from{opacity:0;transform:translateY(26px)} to{opacity:1;transform:translateY(0)} }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FORM
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.sec-title {
  font-family:'Cinzel',serif; font-size:.68rem; letter-spacing:.24em; text-transform:uppercase;
  color:var(--gold); margin-bottom:26px;
  display:flex; align-items:center; gap:12px;
}
.sec-title::after { content:''; flex:1; height:1px; background:linear-gradient(90deg,rgba(201,168,76,.4),transparent); }

.form-grid { display:grid; grid-template-columns:1fr 1fr; gap:15px; }
.span2 { grid-column:1/-1; }

.field { display:flex; flex-direction:column; gap:6px; }
.field label {
  font-family:'Cinzel',serif; font-size:.64rem; letter-spacing:.15em;
  text-transform:uppercase; color:var(--gold);
}
.field label .opt { font-family:'Noto Serif JP',serif; text-transform:none; font-size:.62rem; color:var(--muted); letter-spacing:0; margin-left:6px; }

.field select,
.field input[type=text],
.field input[type=date],
.field input[type=time] {
  background:rgba(255,255,255,.05); border:1px solid rgba(255,255,255,.09);
  border-radius:10px; color:var(--text);
  padding:12px 14px; font-size:.88rem;
  font-family:'Noto Serif JP',serif;
  transition:border-color .22s, box-shadow .22s;
  appearance:none; -webkit-appearance:none; width:100%;
}
.field select:focus, .field input:focus {
  outline:none; border-color:var(--gold);
  box-shadow:0 0 0 3px rgba(201,168,76,.13), inset 0 0 18px rgba(201,168,76,.04);
}
.field select option { background:#150A30; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ORACLE BUTTON
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.oracle-btn {
  width:100%; padding:20px; margin-top:28px;
  background:linear-gradient(135deg,#3B1E8A,#6D28D9,#8B5CF6);
  background-size:200% 200%;
  animation:gradShift 4s ease infinite;
  border:1px solid rgba(139,92,246,.45);
  border-radius:14px; color:#fff;
  font-family:'Cinzel',serif; font-size:1rem; font-weight:600; letter-spacing:.2em;
  cursor:pointer; position:relative; overflow:hidden;
  transition:transform .14s, box-shadow .3s;
  box-shadow:0 0 30px rgba(139,92,246,.25);
}
.oracle-btn::after { content:''; position:absolute; inset:0; background:linear-gradient(rgba(255,255,255,.09),transparent); pointer-events:none; }
.oracle-btn:hover { transform:translateY(-2px); box-shadow:0 10px 48px rgba(139,92,246,.5), 0 0 60px rgba(201,168,76,.12); }
.oracle-btn:active { transform:translateY(0); }
@keyframes gradShift { 0%,100%{background-position:0% 50%} 50%{background-position:100% 50%} }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LOADING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.loading-wrap { display:none; text-align:center; padding:64px 20px; }
.loading-wrap.show { display:block; }

.orb-ring {
  width:86px; height:86px; margin:0 auto 28px; position:relative;
}
.orb-ring::before, .orb-ring::after {
  content:''; position:absolute; border-radius:50%; border:2px solid transparent;
}
.orb-ring::before {
  inset:0; border-top-color:var(--iris-l); border-right-color:var(--gold);
  animation:spin 1.2s linear infinite;
}
.orb-ring::after {
  inset:14px; border-bottom-color:var(--rose); border-left-color:var(--ice);
  animation:spin .75s linear infinite reverse;
}
.orb-crystal { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); font-size:2rem; animation:pulse 1.6s ease-in-out infinite; }
@keyframes spin { to{transform:rotate(360deg)} }
@keyframes pulse { 0%,100%{opacity:.6;transform:translate(-50%,-50%) scale(.88)} 50%{opacity:1;transform:translate(-50%,-50%) scale(1.06)} }

.load-steps { margin-top:28px; }
.load-step { font-family:'Cormorant Garamond',serif; font-style:italic; font-size:.95rem; color:var(--muted); margin:8px 0; opacity:0; transition:opacity .4s; }
.load-step.lit { opacity:1; color:var(--gold-l); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESULT WRAPPER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.result-wrap { display:none; }
.result-wrap.show { display:block; animation:riseIn .8s cubic-bezier(.16,1,.3,1) both; }

/* â”€â”€ Score Hero â”€â”€ */
.score-hero { text-align:center; padding:52px 20px 40px; }
.ring-wrap { width:176px; height:176px; margin:0 auto 22px; position:relative; }
.ring-wrap svg { width:100%; height:100%; transform:rotate(-90deg); filter:drop-shadow(0 0 16px rgba(201,168,76,.42)); }
.ring-inner { position:absolute; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center; }
.score-num {
  font-family:'Cinzel',serif; font-size:3.2rem; font-weight:700; line-height:1;
  background:linear-gradient(180deg,var(--gold-l),var(--gold));
  -webkit-background-clip:text; -webkit-text-fill-color:transparent;
  filter:drop-shadow(0 0 14px rgba(201,168,76,.6));
}
.score-lbl { font-size:.6rem; color:var(--muted); letter-spacing:.22em; text-transform:uppercase; margin-top:4px; }

.verdict-badge {
  display:inline-block; font-family:'Cinzel',serif; font-size:.82rem;
  letter-spacing:.14em; padding:8px 26px; border-radius:40px; border:1px solid;
  margin-bottom:16px;
}

.game-title-disp { font-size:1.1rem; font-weight:700; margin-bottom:5px; }
.target-disp { font-family:'Cormorant Garamond',serif; font-style:italic; font-size:1rem; color:var(--gold); }

/* â”€â”€ Lunar Widget â”€â”€ */
.lunar-chip {
  display:inline-flex; align-items:center; gap:10px;
  background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.08);
  border-radius:40px; padding:8px 18px; margin-top:14px;
  font-size:.8rem; color:var(--muted);
}
.lunar-chip .lc-name { color:var(--text); font-weight:700; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TIME CARDS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.times-heading {
  font-family:'Cinzel',serif; font-size:.78rem; letter-spacing:.22em; color:var(--gold);
  text-align:center; margin:32px 0 16px; text-transform:uppercase;
}

.tc {
  border-radius:var(--r); padding:20px 22px; margin-bottom:12px;
  border:1px solid rgba(255,255,255,.08);
  position:relative; overflow:hidden;
  transition:transform .22s, box-shadow .22s;
}
.tc:hover { transform:translateX(5px); }
.tc.r1 { background:linear-gradient(135deg,rgba(201,168,76,.15),rgba(139,92,246,.08)); border-color:rgba(201,168,76,.38); box-shadow:0 0 32px rgba(201,168,76,.10); }
.tc.r2 { background:linear-gradient(135deg,rgba(139,92,246,.11),rgba(56,189,248,.06)); border-color:rgba(139,92,246,.25); }
.tc.r3 { background:linear-gradient(135deg,rgba(224,85,133,.09),rgba(139,92,246,.06)); border-color:rgba(224,85,133,.2); }
.tc.rlo { background:rgba(255,255,255,.03); }
.tc.expired { opacity:.4; filter:grayscale(.6); pointer-events:none; }

.tc-top { display:flex; align-items:baseline; gap:10px; margin-bottom:10px; flex-wrap:wrap; }
.tc-rank-num { font-family:'Cinzel',serif; font-size:.62rem; color:var(--muted); letter-spacing:.1em; position:absolute; top:16px; right:16px; }
.tc-date { font-family:'Cinzel',serif; font-size:.7rem; color:var(--gold); letter-spacing:.1em; }
.tc-time { font-family:'Cinzel',serif; font-size:1.42rem; font-weight:700; color:var(--text); letter-spacing:.04em; }

.tc-pinpoint {
  display:inline-flex; align-items:center; gap:7px;
  font-size:.82rem; font-weight:700; color:var(--danger);
  background:rgba(248,113,113,.1); border:1px solid rgba(248,113,113,.25);
  border-radius:8px; padding:5px 12px; margin-bottom:13px;
}

.tc-bot { display:flex; align-items:center; gap:12px; flex-wrap:wrap; }
.tc-pulls {
  display:inline-flex; align-items:center; gap:8px;
  background:rgba(201,168,76,.12); border:1px solid rgba(201,168,76,.28);
  border-radius:8px; padding:6px 14px;
  font-family:'Cinzel',serif; font-size:.78rem; color:var(--gold-l);
}
.tc-pulls strong { font-size:1.1rem; }
.tc-bar { flex:1; height:4px; background:rgba(255,255,255,.08); border-radius:4px; overflow:hidden; min-width:50px; }
.tc-bar-fill { height:100%; border-radius:4px; }

.badge {
  font-family:'Cinzel',serif; font-size:.6rem; letter-spacing:.08em; font-weight:600;
  padding:3px 10px; border-radius:20px;
}
.b-urgent  { background:rgba(248,113,113,.18); border:1px solid rgba(248,113,113,.38); color:var(--danger); }
.b-special { background:rgba(201,168,76,.18); border:1px solid rgba(201,168,76,.38); color:var(--gold-l); }
.b-done    { background:rgba(255,255,255,.05); border:1px solid var(--rim); color:var(--muted); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DIVINATION CARDS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.div-grid { display:grid; gap:13px; margin-top:16px; }
.div-card {
  background:rgba(255,255,255,.03); border:1px solid rgba(255,255,255,.07);
  border-radius:14px; padding:20px;
  transition:border-color .22s;
}
.div-card:hover { border-color:rgba(201,168,76,.22); }
.div-hdr { display:flex; align-items:center; gap:10px; margin-bottom:9px; }
.div-icon { font-size:1.25rem; flex-shrink:0; }
.div-name { font-family:'Cinzel',serif; font-size:.68rem; letter-spacing:.16em; color:var(--gold); text-transform:uppercase; }
.div-score { margin-left:auto; font-family:'Cinzel',serif; font-size:.68rem; padding:3px 10px; border-radius:20px; background:rgba(201,168,76,.1); border:1px solid rgba(201,168,76,.22); color:var(--gold-l); }
.div-bar { height:3px; background:rgba(255,255,255,.07); border-radius:2px; overflow:hidden; margin-bottom:11px; }
.div-bar-fill { height:100%; border-radius:2px; }
.div-body { font-family:'Cormorant Garamond',serif; font-size:1.02rem; line-height:1.78; color:rgba(237,230,245,.88); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   OCCULT BOX
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.occult-box {
  border-radius:var(--r); padding:26px;
  background:rgba(139,92,246,.06); border:1px dashed rgba(139,92,246,.3);
}
.occult-title { font-family:'Cinzel',serif; font-size:.76rem; letter-spacing:.2em; color:var(--iris-l); text-align:center; margin-bottom:4px; text-transform:uppercase; }
.occult-sub { font-size:.7rem; color:var(--muted); text-align:center; margin-bottom:18px; }
.jinx {
  display:flex; align-items:flex-start; gap:10px;
  padding:12px 14px; margin-bottom:8px; border-radius:10px;
  font-size:.88rem; line-height:1.55;
}
.jinx:nth-child(odd)  { background:rgba(139,92,246,.08); }
.jinx:nth-child(even) { background:rgba(201,168,76,.06); }
.jinx-ic { flex-shrink:0; font-size:1.05rem; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LUCKY ACTIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.action-list { list-style:none; }
.action-item {
  display:flex; align-items:flex-start; gap:12px;
  padding:12px 0; border-bottom:1px solid rgba(255,255,255,.05);
  font-size:.88rem; line-height:1.65;
}
.action-item:last-child { border-bottom:none; }
.action-num {
  flex-shrink:0; width:22px; height:22px; border-radius:50%;
  background:rgba(201,168,76,.14); border:1px solid rgba(201,168,76,.28);
  display:flex; align-items:center; justify-content:center;
  font-family:'Cinzel',serif; font-size:.58rem; color:var(--gold); margin-top:2px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BUTTONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.dl-btn, .rst-btn {
  width:100%; padding:17px; border:none; border-radius:12px;
  font-family:'Cinzel',serif; font-size:.86rem; font-weight:600; letter-spacing:.16em;
  cursor:pointer; overflow:hidden; transition:transform .15s, box-shadow .3s; margin-top:12px;
}
.dl-btn {
  background:linear-gradient(135deg,#7A5518,#C9A84C,#EDD070); color:#06040C;
  box-shadow:0 4px 24px rgba(201,168,76,.3);
}
.dl-btn:hover { transform:translateY(-2px); box-shadow:0 8px 36px rgba(201,168,76,.48); }
.rst-btn {
  background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.09); color:var(--muted);
}
.rst-btn:hover { border-color:var(--danger); color:var(--danger); background:rgba(248,113,113,.06); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FOOTER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.site-footer {
  text-align:center; padding:44px 0 20px;
  font-family:'Cormorant Garamond',serif; font-style:italic;
  font-size:.92rem; color:var(--muted); letter-spacing:.1em;
}
.site-footer span { color:var(--gold); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESPONSIVE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media(max-width:560px) {
  .form-grid { grid-template-columns:1fr; }
  .glass { padding:22px 18px; }
  .hdr { padding:48px 0 38px; }
}

/* â”€â”€ scrollbar â”€â”€ */
::-webkit-scrollbar { width:5px; }
::-webkit-scrollbar-track { background:var(--void); }
::-webkit-scrollbar-thumb { background:rgba(139,92,246,.38); border-radius:3px; }
</style>
</head>
<body>

<canvas id="cosmos"></canvas>
<div class="bg-nebula"></div>
<div class="grain"></div>

<div class="wrap">

<!-- â”€â”€ HEADER â”€â”€ -->
<header class="hdr">
  <span class="hdr-sigil">ğŸ”®</span>
  <h1>GACHA ORACLE<br><span style="font-size:.52em;letter-spacing:.32em;opacity:.8">éœŠçœ¼çµ±åˆå è¡“ã‚·ã‚¹ãƒ†ãƒ </span></h1>
  <p class="hdr-sub">by ã‚¯ãƒˆã¡ã‚ƒã‚“ â€” å…¨å è¡“ Ã— ã‚ªã‚«ãƒ«ãƒˆæƒ…å ± èåˆ</p>
  <div class="hdr-tags">
    <span class="hdr-tag">è¥¿æ´‹å æ˜Ÿè¡“</span>
    <span class="hdr-tag">ä¹æ˜Ÿæ°—å­¦</span>
    <span class="hdr-tag">å››æŸ±æ¨å‘½</span>
    <span class="hdr-tag">æœˆé½¢è¨ˆç®—</span>
    <span class="hdr-tag">ã‚¿ãƒ­ãƒƒãƒˆ</span>
    <span class="hdr-tag">æ•°ç§˜è¡“</span>
    <span class="hdr-tag">è¡€æ¶²å‹</span>
  </div>
</header>

<!-- â”€â”€ FORM CARD â”€â”€ -->
<div class="glass">
  <p class="sec-title">å è¡“æƒ…å ±ã‚’å…¥åŠ›</p>
  <form id="fortuneForm">
    <div class="form-grid">

      <div class="field span2">
        <label for="gameTitle">ã‚²ãƒ¼ãƒ ã‚¿ã‚¤ãƒˆãƒ« <span class="opt">â€»å¿…é ˆ</span></label>
        <select id="gameTitle" required>
          <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
          <option value="ã‚¦ãƒå¨˜">ã‚¦ãƒå¨˜ ãƒ—ãƒªãƒ†ã‚£ãƒ¼ãƒ€ãƒ¼ãƒ“ãƒ¼</option>
          <option value="ãƒ–ãƒ«ãƒ¼ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–">ãƒ–ãƒ«ãƒ¼ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–</option>
          <option value="åŸç¥">åŸç¥</option>
          <option value="NIKKE">å‹åˆ©ã®å¥³ç¥ï¼šNIKKE</option>
          <option value="å´©å£Šï¼šã‚¹ã‚¿ãƒ¼ãƒ¬ã‚¤ãƒ«">å´©å£Šï¼šã‚¹ã‚¿ãƒ¼ãƒ¬ã‚¤ãƒ«</option>
          <option value="é³´æ½®">é³´æ½®</option>
          <option value="Fate/GO">Fate/Grand Order</option>
          <option value="ã‚¼ãƒ³ãƒ¬ã‚¹ã‚¾ãƒ¼ãƒ³ã‚¼ãƒ­">ã‚¼ãƒ³ãƒ¬ã‚¹ã‚¾ãƒ¼ãƒ³ã‚¼ãƒ­</option>
          <option value="LINE MF">LINE ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ãƒ•ã‚¡ãƒ¼ãƒ </option>
          <option value="Echocalypse">Echocalypse</option>
          <option value="Evertale">Evertale</option>
          <option value="PokÃ©mon Trading Card Game Pocket">PokÃ©mon TCG Pocket</option>
          <option value="ãƒ—ãƒªã‚³ãƒR">ãƒ—ãƒªãƒ³ã‚»ã‚¹ã‚³ãƒã‚¯ãƒˆï¼Re:Dive</option>
          <option value="ã‚°ãƒ©ãƒ–ãƒ«">ã‚°ãƒ©ãƒ³ãƒ–ãƒ«ãƒ¼ãƒ•ã‚¡ãƒ³ã‚¿ã‚¸ãƒ¼</option>
          <option value="ã‚¢ã‚ºãƒ¼ãƒ«ãƒ¬ãƒ¼ãƒ³">ã‚¢ã‚ºãƒ¼ãƒ«ãƒ¬ãƒ¼ãƒ³</option>
          <option value="ãƒ˜ãƒ–ãƒãƒ³">ãƒ˜ãƒ–ãƒ³ãƒãƒ¼ãƒ³ã‚ºãƒ¬ãƒƒãƒ‰</option>
          <option value="DQã‚¦ã‚©ãƒ¼ã‚¯">ãƒ‰ãƒ©ã‚´ãƒ³ã‚¯ã‚¨ã‚¹ãƒˆã‚¦ã‚©ãƒ¼ã‚¯</option>
          <option value="ç™½çŒ«">ç™½çŒ«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ</option>
          <option value="ãã®ä»–">ãã®ä»–ï¼ˆè‡ªç”±å…¥åŠ›ï¼‰</option>
        </select>
      </div>

      <div class="field span2" id="customGameGroup" style="display:none">
        <label for="customGame">ã‚²ãƒ¼ãƒ ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›</label>
        <input type="text" id="customGame" placeholder="ä¾‹: ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã‚¹ãƒˆãƒ©ã‚¤ã‚¯">
      </div>

      <div class="field span2">
        <label for="targetName">ç‹™ã£ã¦ã„ã‚‹ã‚­ãƒ£ãƒ©/æ­¦å™¨å <span class="opt">(ä»»æ„)</span></label>
        <input type="text" id="targetName" placeholder="ä¾‹: é«˜å‚éº—å¥ˆã€è‰è–™ã®å‰£">
      </div>

      <div class="field span2">
        <label for="gachaTitle">ã‚¬ãƒãƒ£ã‚¿ã‚¤ãƒˆãƒ« <span class="opt">(ä»»æ„)</span></label>
        <input type="text" id="gachaTitle" placeholder="ä¾‹: éŸ¿ã‘!ãƒ¦ãƒ¼ãƒ•ã‚©ãƒ‹ã‚¢ãƒ ã‚³ãƒ©ãƒœã€æ­£æœˆã‚¬ãƒãƒ£">
      </div>

      <div class="field">
        <label for="gachaDeadline">ã‚¬ãƒãƒ£æœŸé™ï¼ˆæ—¥ä»˜ï¼‰ <span class="opt">(ä»»æ„)</span></label>
        <input type="date" id="gachaDeadline">
      </div>

      <div class="field">
        <label for="gachaDeadlineTime">ã‚¬ãƒãƒ£æœŸé™ï¼ˆæ™‚åˆ»ï¼‰</label>
        <input type="time" id="gachaDeadlineTime" value="23:59">
      </div>

      <div class="field">
        <label for="birthdate">ç”Ÿå¹´æœˆæ—¥ <span class="opt">(ä»»æ„)</span></label>
        <input type="date" id="birthdate" max="2010-12-31">
      </div>

      <div class="field">
        <label for="zodiac">æ˜Ÿåº§ <span class="opt">(ä»»æ„)</span></label>
        <select id="zodiac">
          <option value="">é¸æŠ</option>
          <option>ç‰¡ç¾Šåº§</option><option>ç‰¡ç‰›åº§</option><option>åŒå­åº§</option><option>èŸ¹åº§</option>
          <option>ç…å­åº§</option><option>ä¹™å¥³åº§</option><option>å¤©ç§¤åº§</option><option>è åº§</option>
          <option>å°„æ‰‹åº§</option><option>å±±ç¾Šåº§</option><option>æ°´ç“¶åº§</option><option>é­šåº§</option>
        </select>
      </div>

      <div class="field">
        <label for="bloodType">è¡€æ¶²å‹ <span class="opt">(ä»»æ„)</span></label>
        <select id="bloodType">
          <option value="">é¸æŠ</option>
          <option>Aå‹</option><option>Bå‹</option><option>Oå‹</option><option>ABå‹</option>
        </select>
      </div>

      <div class="field">
        <label for="eto">å¹²æ”¯ <span class="opt">(ä»»æ„)</span></label>
        <select id="eto">
          <option value="">é¸æŠ</option>
          <option value="å­">å­ï¼ˆã­ãšã¿ï¼‰</option><option value="ä¸‘">ä¸‘ï¼ˆã†ã—ï¼‰</option>
          <option value="å¯…">å¯…ï¼ˆã¨ã‚‰ï¼‰</option><option value="å¯">å¯ï¼ˆã†ã•ãï¼‰</option>
          <option value="è¾°">è¾°ï¼ˆãŸã¤ï¼‰</option><option value="å·³">å·³ï¼ˆã¸ã³ï¼‰</option>
          <option value="åˆ">åˆï¼ˆã†ã¾ï¼‰</option><option value="æœª">æœªï¼ˆã²ã¤ã˜ï¼‰</option>
          <option value="ç”³">ç”³ï¼ˆã•ã‚‹ï¼‰</option><option value="é…‰">é…‰ï¼ˆã¨ã‚Šï¼‰</option>
          <option value="æˆŒ">æˆŒï¼ˆã„ã¬ï¼‰</option><option value="äº¥">äº¥ï¼ˆã„ã®ã—ã—ï¼‰</option>
        </select>
      </div>

    </div><!-- /form-grid -->
    <button type="submit" class="oracle-btn">âœ¦ éœŠçœ¼ã‚’é–‹ã â€” å è¡“é–‹å§‹ âœ¦</button>
  </form>
</div>

<!-- â”€â”€ LOADING â”€â”€ -->
<div class="glass loading-wrap" id="loading">
  <div class="orb-ring"><span class="orb-crystal">ğŸ”®</span></div>
  <div class="load-steps">
    <p class="load-step" id="ls1">âœ¦ å¤©ä½“ã®ä½ç›¸ã‚’è¨ˆæ¸¬ä¸­...</p>
    <p class="load-step" id="ls2">âœ¦ æœˆé½¢ã¨æ½®æ±åŠ›ã‚’è§£æä¸­...</p>
    <p class="load-step" id="ls3">âœ¦ ä¹æ˜Ÿæ°—å­¦ã®ç›¤ã‚’å±•é–‹ä¸­...</p>
    <p class="load-step" id="ls4">âœ¦ ã‚¿ãƒ­ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ã‚’é¸å®šä¸­...</p>
    <p class="load-step" id="ls5">âœ¦ éœŠçœ¼ãŒé–‹ã‹ã‚Œã¤ã¤ã‚ã‚‹...</p>
  </div>
</div>

<!-- â”€â”€ RESULT â”€â”€ -->
<div class="result-wrap" id="result"></div>

<!-- â”€â”€ FOOTER â”€â”€ -->
<footer class="site-footer">
  Powered by <span>ã‚¯ãƒˆã¡ã‚ƒã‚“</span> ğŸ’« éœŠçœ¼çµ±åˆå è¡“ã‚·ã‚¹ãƒ†ãƒ <br>
  <span style="font-size:.78rem;opacity:.6">è¥¿æ´‹å æ˜Ÿè¡“ Â· ä¹æ˜Ÿæ°—å­¦ Â· å››æŸ±æ¨å‘½ Â· æœˆé½¢ Â· ã‚¿ãƒ­ãƒƒãƒˆ Â· æ•°ç§˜è¡“ Â· è¡€æ¶²å‹ Â· å¹²æ”¯ çµ±åˆ</span>
</footer>

</div><!-- /wrap -->

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//   CANVAS COSMOS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function(){
  const cv = document.getElementById('cosmos');
  const ctx = cv.getContext('2d');
  let W, H, stars = [], shoots = [];

  function resize(){ W = cv.width = window.innerWidth; H = cv.height = window.innerHeight; }
  window.addEventListener('resize', resize); resize();

  for(let i=0;i<220;i++) stars.push({
    x: Math.random(), y: Math.random(),
    r: Math.random()*1.3+.2,
    a: Math.random(), da: (Math.random()-.5)*.006,
    speed: Math.random()*.003+.0005
  });

  function addShoot(){
    shoots.push({ x:Math.random()*W, y:Math.random()*H*.4, angle:-25+Math.random()*20, len:0, maxLen:80+Math.random()*120, speed:6+Math.random()*6, alpha:1 });
  }
  setInterval(addShoot, 3500);

  function frame(){
    ctx.clearRect(0,0,W,H);
    stars.forEach(s=>{
      s.a += s.da;
      if(s.a<.08||s.a>1) s.da*=-1;
      ctx.beginPath();
      ctx.arc(s.x*W, s.y*H, s.r, 0, Math.PI*2);
      ctx.fillStyle = `rgba(255,255,255,${Math.max(.08,s.a)})`;
      ctx.fill();
    });
    shoots = shoots.filter(s=>{
      s.len += s.speed;
      s.alpha = Math.max(0, 1 - s.len/s.maxLen);
      if(s.alpha<=0) return false;
      ctx.save();
      ctx.translate(s.x, s.y);
      ctx.rotate(s.angle*Math.PI/180);
      const g = ctx.createLinearGradient(0,0,s.len,0);
      g.addColorStop(0,'transparent');
      g.addColorStop(.3,`rgba(255,255,255,${s.alpha*.6})`);
      g.addColorStop(1,'transparent');
      ctx.strokeStyle=g; ctx.lineWidth=1.5;
      ctx.beginPath(); ctx.moveTo(0,0); ctx.lineTo(s.len,0); ctx.stroke();
      ctx.restore();
      return true;
    });
    requestAnimationFrame(frame);
  }
  frame();
})();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//   GAME OCCULT DATABASE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const GAME_DB = {
  'ã‚¦ãƒå¨˜':               { luckyDays:[3], luckyHours:[5,6,7,18,19], updateDay:3, updateHour:18, jinxes:['æ°´æ›œ18:00æ›´æ–°ç›´å¾ŒãŒæœ€ã‚‚ç†±ã„','æœ5:00ã€œ7:00ã«å¥‡è·¡å ±å‘Šå¤šæ•°ã‚ã‚Š','æº€æœˆã®å¤œã¯SSRç¢ºç‡ä¸Šæ˜‡ã®éƒ½å¸‚ä¼èª¬'] },
  'ãƒ–ãƒ«ãƒ¼ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–':      { luckyDays:[1], luckyHours:[2,3,4,11,22], updateDay:1, updateHour:11, jinxes:['æœˆæ›œãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ç›´å¾ŒãŒç‹™ã„ç›®','æ·±å¤œ2:00ã€œ4:00ã®é™å¯‚ã‚¾ãƒ¼ãƒ³','ã‚¾ãƒ­ç›®æ™‚åˆ»ï¼ˆ11:11, 22:22ï¼‰ãŒæ¿€ã‚¢ãƒ„'] },
  'å´©å£Šï¼šã‚¹ã‚¿ãƒ¼ãƒ¬ã‚¤ãƒ«':    { luckyDays:[4], luckyHours:[6,7,8,18], updateDay:4, updateHour:18, jinxes:['æœ¨æ›œæ›´æ–°ãŒåŸºæœ¬ã‚µã‚¤ã‚¯ãƒ«','æœ6:00ã€œ8:00ãŒæœ€ã‚‚å‡ºã‚„ã™ã„','èª²é‡‘ç›´å¾Œ30åˆ†ã¯é¿ã‘ã‚‹ã¹ã—èª¬'] },
  'NIKKE':               { luckyDays:[5], luckyHours:[19,20,21], updateDay:5, updateHour:11, jinxes:['é‡‘æ›œå¤œã®ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ã‚¿ã‚¤ãƒ ','19:00ã€œ21:00ãŒé»„é‡‘å¸¯','ãƒ¡ãƒ³ãƒ†æ˜ã‘1æ™‚é–“ä»¥å†…ãŒæœ€å¼·'] },
  'åŸç¥':                { luckyDays:[2], luckyHours:[0,18,19,20], updateDay:2, updateHour:18, jinxes:['ç«æ›œ18:00æ›´æ–°ç›´å¾ŒãŒå‹è² ','æ›´æ–°ã‹ã‚‰3æ™‚é–“ä»¥å†…ãŒé‰„æ¿','æ·±å¤œ0:00ã‚¸ãƒ£ã‚¹ãƒˆã¯å¥‡è·¡ã®æ™‚åˆ»'] },
  'Fate/GO':             { luckyDays:[3,6], luckyHours:[12,18,21], jinxes:['ãƒ”ãƒƒã‚¯ã‚¢ãƒƒãƒ—åˆæ—¥ãŒæœ€ã‚‚ç†±ã„','21:00å‰å¾Œã«çˆ†æ­»ãƒ»çˆ†å½“ãŸã‚Šä¸¡æ–¹å¤šæ•°','0æ™‚å›ã—ã¯çœŸå½ä¸æ˜ã®éƒ½å¸‚ä¼èª¬'] },
  'ã‚¼ãƒ³ãƒ¬ã‚¹ã‚¾ãƒ¼ãƒ³ã‚¼ãƒ­':    { luckyDays:[3,4], luckyHours:[11,18,19,20], updateDay:3, updateHour:11, jinxes:['æ°´æ›œãƒ¡ãƒ³ãƒ†å¾ŒãŒæ¿€ã‚¢ãƒ„','18:00ã€œ20:00ã®ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ã‚¿ã‚¤ãƒ ','11:11ã®ã‚¾ãƒ­ç›®æ™‚åˆ»ãŒå¥‡è·¡ã‚’å‘¼ã¶'] },
  'LINE MF':             { luckyDays:[2,5], luckyHours:[12,18,21,22], jinxes:['ç«ãƒ»é‡‘æ›´æ–°ç›´å¾Œ','22:22ã®ã‚¾ãƒ­ç›®ãŒå¹¸é‹ã®åˆ»','æ·±å¤œã‚ˆã‚Šã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ã‚¿ã‚¤ãƒ æ¨å¥¨'] },
  'Echocalypse':         { luckyDays:[4,5], luckyHours:[0,6,7,18,19], jinxes:['æœ¨æ›œãƒ¡ãƒ³ãƒ†å¾Œ1æ™‚é–“ãŒæœ€å¼·','æœ6:00ã€œ7:00ã®æ—©æœã‚¾ãƒ¼ãƒ³','æ·±å¤œ0:00ãƒªã‚»ãƒƒãƒˆç›´å¾Œ'] },
  'Evertale':            { luckyDays:[1,5], luckyHours:[3,12,18,21], jinxes:['æœˆãƒ»é‡‘ãŒç‹™ã„ç›®ã®æ›œæ—¥','æ·±å¤œ3:00ã®é­”ã®æ™‚é–“å¸¯','18:00ã€œ21:00ãŒå®‰å®šå ±å‘Šå¤šæ•°'] },
  'PokÃ©mon Trading Card Game Pocket': { luckyDays:[2,5], luckyHours:[7,8,12,18,19], updateDay:2, updateHour:7, jinxes:['æœ7:00ã€œ8:00ã®ãƒ¢ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ‘ãƒƒã‚¯','ç«ãƒ»é‡‘ã®æ–°å¼¾è¿½åŠ ç›´å¾Œ','12:00ã¨18:00ã®ãƒ‡ã‚¤ãƒªãƒ¼ãƒªã‚»ãƒƒãƒˆ'] },
  'é³´æ½®':               { luckyDays:[4], luckyHours:[6,11,18,19,20], updateDay:4, updateHour:11, jinxes:['æœ¨æ›œãƒ¡ãƒ³ãƒ†å¾ŒãŒé‰„æ¿ã®ç‹™ã„ç›®','æœ6:00ã®æ—©æœã‚¬ãƒãƒ£','18:00ã€œ20:00ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ã‚¿ã‚¤ãƒ '] },
  'ãƒ—ãƒªã‚³ãƒR':           { luckyDays:[1,5], luckyHours:[5,12,18,19], updateDay:1, updateHour:5, jinxes:['æœˆæ›œ5:00ã‚¬ãƒãƒ£æ›´æ–°ç›´å¾ŒãŒæœ€å¼·','12:00ã¨18:00ã®ãƒ‡ã‚¤ãƒªãƒ¼ãƒªã‚»ãƒƒãƒˆ','é‡‘æ›œå¤œã¯å½“ãŸã‚ŠãŒå¤šã„èª¬'] },
  'ã‚°ãƒ©ãƒ–ãƒ«':            { luckyDays:[1,4], luckyHours:[12,17,19,22], updateDay:1, updateHour:12, jinxes:['æœˆæ›œ12:00ãƒ¬ã‚¸ã‚§ãƒ•ã‚§ã‚¹é–‹å¹•ç›´å¾Œ','17:00ã¨19:00ã®ãƒã‚°ãƒŠã‚¿ã‚¤ãƒ ','22:00ã®æ·±å¤œã‚¬ãƒãƒ£ã¯åˆ¥æ ¼'] },
  'ã‚¢ã‚ºãƒ¼ãƒ«ãƒ¬ãƒ¼ãƒ³':       { luckyDays:[4], luckyHours:[0,5,12,18], updateDay:4, updateHour:5, jinxes:['æœ¨æ›œãƒ¡ãƒ³ãƒ†æ˜ã‘ãŒé‰„æ¿','æ·±å¤œ0:00ãƒ‡ã‚¤ãƒªãƒ¼ãƒªã‚»ãƒƒãƒˆå¾Œ','12:00æ˜¼ä¼‘ã¿ã‚¬ãƒãƒ£ãŒå®‰å®š'] },
  'ãƒ˜ãƒ–ãƒãƒ³':            { luckyDays:[2,5], luckyHours:[11,15,18,21], updateDay:2, updateHour:15, jinxes:['ç«æ›œ15:00æ›´æ–°ç›´å¾ŒãŒæœ€å¼·','18:00ã€œ21:00ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ã‚¿ã‚¤ãƒ ','é‡‘æ›œå¤œã¯å½“ãŸã‚Šã‚„ã™ã„èª¬'] },
  'DQã‚¦ã‚©ãƒ¼ã‚¯':          { luckyDays:[1,5], luckyHours:[6,12,15,18], updateDay:5, updateHour:15, jinxes:['é‡‘æ›œ15:00ã‚¬ãƒãƒ£æ›´æ–°','æœ6:00ã®æ•£æ­©ã‚¬ãƒãƒ£','12:00ã¨18:00ã®ãƒ‡ã‚¤ãƒªãƒ¼æ›´æ–°å¾Œ'] },
  'ç™½çŒ«':               { luckyDays:[1,4], luckyHours:[12,15,18,21], updateDay:1, updateHour:15, jinxes:['æœˆæ›œ15:00ã‚¬ãƒãƒ£æ›´æ–°ç›´å¾Œ','12:00æ˜¼ä¼‘ã¿ãŒé‰„æ¿','21:00å¤œã®ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ã‚¿ã‚¤ãƒ '] }
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//   REAL DIVINATION ALGORITHMS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/* â”€â”€ æœˆé½¢è¨ˆç®—ï¼ˆMeeuså¼è¿‘ä¼¼ï¼‰ â”€â”€ */
function getMoonAge(date) {
  const jd = (date / 86400000) + 2440587.5;
  const T  = (jd - 2451545.0) / 36525;
  const D  = 297.85036 + 445267.111480*T - 0.0019142*T*T + T*T*T/189474;
  const M  = 357.52772 + 35999.050340*T - 0.0001603*T*T - T*T*T/300000;
  const Mp = 93.27191  + 483202.017538*T - 0.0086972*T*T + T*T*T/56250;
  const phase = ((D % 360) + 360) % 360;
  const age   = Math.round(phase / 12.19);
  return { age: Math.min(29, age), phase };
}

function getMoonPhaseInfo(age) {
  if(age<=1||age>=28)  return { name:'æ–°æœˆ',    icon:'ğŸŒ‘', power:'æµ„åŒ–ãƒ»å†ç”Ÿãƒ»æ–°ã—ã„å§‹ã¾ã‚Š', luckBonus:8 };
  if(age<=7)           return { name:'ä¸‰æ—¥æœˆ',   icon:'ğŸŒ’', power:'æˆé•·ãƒ»æ–°è¦é–‹å§‹ã®ã‚¨ãƒãƒ«ã‚®ãƒ¼', luckBonus:5 };
  if(age<=8)           return { name:'ä¸Šå¼¦ã®æœˆ', icon:'ğŸŒ“', power:'è¡Œå‹•ãƒ»æ±ºæ–­åŠ›ã®é«˜ã¾ã‚Š', luckBonus:6 };
  if(age<=13)          return { name:'åä¸‰å¤œ',   icon:'ğŸŒ”', power:'å……å®Ÿãƒ»é”æˆã¸ã®åŠ©èµ°', luckBonus:9 };
  if(age<=15)          return { name:'æº€æœˆ',     icon:'ğŸŒ•', power:'æœ€å¼·ã®å¼•ãå¯„ã›ãƒ»æ„Ÿæƒ…ã®é«˜ã¾ã‚Š', luckBonus:14 };
  if(age<=22)          return { name:'ä¸‹å¼¦',     icon:'ğŸŒ—', power:'æ‰‹æ”¾ã—ãƒ»æ•´ç†ã®ã‚¨ãƒãƒ«ã‚®ãƒ¼', luckBonus:3 };
  return                      { name:'æ™¦æ—¥å‰',   icon:'ğŸŒ˜', power:'å†…çœãƒ»æº–å‚™ã®æ™‚', luckBonus:4 };
}

/* â”€â”€ ä¹æ˜Ÿæ°—å­¦ï¼ˆæœ¬å‘½æ˜Ÿãƒ»æœˆå‘½æ˜Ÿï¼‰ç”Ÿå¹´ã§è¨ˆç®— â”€â”€ */
function getKyusei(year, month, birthYear) {
  // æœ¬å‘½æ˜Ÿ: ç”Ÿå¹´ã®æ¡å’Œã‹ã‚‰è¨ˆç®—ï¼ˆ11ã‹ã‚‰å¼•ãï¼‰
  const byear = birthYear || year;
  let sum = String(byear).split('').map(Number).reduce((a,b)=>a+b,0);
  while (sum >= 10) sum = String(sum).split('').map(Number).reduce((a,b)=>a+b,0);
  let honmei = 11 - sum;
  if (honmei <= 0) honmei += 9;
  if (honmei > 9)  honmei -= 9;
  // æœˆå‘½æ˜Ÿ: ç”Ÿã¾ã‚ŒãŸæœˆã®æ˜Ÿï¼ˆå›ºå®šå€¤ = ç”Ÿå¹´ã®å¹´ç›¤ä¸­å®® Ã— ç”Ÿæœˆã®ç¯€æœˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼‰
  // â€» ä»Šæœˆã®æœˆç›¤ä¸­å®®ã§ã¯ãªãã€ç”Ÿã¾ã‚ŒãŸæœˆã®æœˆå‘½æ˜Ÿ
  let msum = String(byear).split('').map(Number).reduce((a,b)=>a+b,0);
  while (msum >= 10) msum = String(msum).split('').map(Number).reduce((a,b)=>a+b,0);
  let birthYearCenter = 11 - msum; if (birthYearCenter<=0) birthYearCenter+=9; if (birthYearCenter>9) birthYearCenter-=9;
  // å¯…æœˆã®æœˆå‘½æ˜ŸåŸºæº–ï¼ˆä¸€,å››,ä¸ƒå¹´â†’8, äºŒ,äº”,å…«å¹´â†’5, ä¸‰,å…­,ä¹å¹´â†’2ï¼‰
  const baseMap = {1:8,2:5,3:2,4:8,5:5,6:2,7:8,8:5,9:2};
  const tsuikiBase = baseMap[birthYearCenter];
  // ç”Ÿã¾ã‚ŒãŸæœˆã®ç¯€æœˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’æ±‚ã‚ã‚‹ï¼ˆç”Ÿå¹´æœˆæ—¥ã‹ã‚‰ï¼‰
  // ç¯€æ°—æ¦‚ç®—æ—¥ï¼ˆå„æœˆ1ã€œ12æœˆã®ç¯€å…¥ã‚Šæ—¥ï¼‰
  const SETSU_DAYS = [6,4,6,5,6,6,7,8,8,8,8,7];
  let birthMonthIdx = 0;
  if (birthdate) {
    const bd = new Date(birthdate);
    const bmo = bd.getMonth();     // 0-indexed
    const bday = bd.getDate();
    const adjMo = bday >= SETSU_DAYS[bmo] ? bmo : (bmo - 1 + 12) % 12;
    birthMonthIdx = (adjMo - 1 + 12) % 12; // å¯…æœˆ=0, å¯æœˆ=1, è¾°æœˆ=2...
  }
  const getukumei = ((tsuikiBase - 1 - birthMonthIdx) % 9 + 9) % 9 + 1;
  const names = ['','ä¸€ç™½æ°´æ˜Ÿ','äºŒé»’åœŸæ˜Ÿ','ä¸‰ç¢§æœ¨æ˜Ÿ','å››ç·‘æœ¨æ˜Ÿ','äº”é»„åœŸæ˜Ÿ','å…­ç™½é‡‘æ˜Ÿ','ä¸ƒèµ¤é‡‘æ˜Ÿ','å…«ç™½åœŸæ˜Ÿ','ä¹ç´«ç«æ˜Ÿ'];
  const luck  = [0,72,68,80,75,65,88,82,70,78];
  return { honmei: names[honmei]||'', getukumei: names[getukumei]||'', score: luck[honmei]||70 };
}

/* â”€â”€ æ•°ç§˜è¡“ï¼ˆãƒ”ã‚¿ã‚´ãƒ©ã‚¹å¼ å‘½æ•°è¨ˆç®—ï¼‰ â”€â”€ */
function calcLifePath(dateStr) {
  if(!dateStr) return null;
  let sum = dateStr.replace(/-/g,'').split('').reduce((a,c)=>a+parseInt(c),0);
  while(sum>9 && sum!==11 && sum!==22 && sum!==33) {
    sum = String(sum).split('').reduce((a,c)=>a+parseInt(c),0);
  }
  return sum;
}

const LIFEPATH_INFO = {
  1:  { kw:'è‡ªç«‹ãƒ»å…ˆé§†è€…',  msg:'å‘½æ•°1ã¯å¤ªé™½ã®åŠ›ã€‚ãƒªãƒ¼ãƒ€ãƒ¼ã¨ã—ã¦å¼•ãå¯„ã›ã‚‹æ‰èƒ½ãŒä»Šæ—¥ã‚‚è¼ãã€‚ç›´æ„Ÿã‚’ä¿¡ã˜ã¦ã‚¬ãƒãƒ£ã‚’å¼•ãç¬é–“ãŒé‹å‘½ã‚’é–‹ãã€‚', bonus:4 },
  2:  { kw:'å”èª¿ãƒ»ç›´æ„Ÿ',   msg:'å‘½æ•°2ã¯æœˆã®åŠ›ã€‚ç¹Šç´°ãªç›´æ„ŸãŒå‹è² ã‚’åˆ†ã‘ã‚‹ã€‚é™ã‹ãªæ™‚é–“å¸¯ã«å¼•ãã“ã¨ã§ç¸ãŒæœ€å¤§åŒ–ã™ã‚‹ã€‚', bonus:3 },
  3:  { kw:'å‰µé€ ãƒ»è¡¨ç¾',   msg:'å‘½æ•°3ã¯æœ¨æ˜Ÿã®åŠ›ã€‚æ¥½ã—ã„æ°—æŒã¡ã§å¼•ãã“ã¨è‡ªä½“ãŒæœ€å¼·ã®ãŠã¾ã˜ãªã„ã€‚ç¬‘é¡”ã§è‡¨ã‚€ã¹ã—ã€‚', bonus:5 },
  4:  { kw:'å®‰å®šãƒ»åŸºç›¤',   msg:'å‘½æ•°4ã¯åœ°ã®åŠ›ã€‚è¨ˆç”»çš„ã«è‡¨ã‚€ã“ã¨ã§ç¢ºå®Ÿã«çµæœã‚’å¼•ãå¯„ã›ã‚‹ã€‚æ€¥ãŒã°å›ã‚Œã®ç²¾ç¥ãŒå‰ã€‚', bonus:2 },
  5:  { kw:'å¤‰åŒ–ãƒ»å†’é™º',   msg:'å‘½æ•°5ã¯æ°´æ˜Ÿã®åŠ›ã€‚äºˆæƒ³å¤–ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã«å¥‡è·¡ãŒå®¿ã‚‹ã€‚ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚’å¤–ã—ãŸè¡Œå‹•ãŒé‹æ°—ã‚’å¤‰ãˆã‚‹ã€‚', bonus:6 },
  6:  { kw:'æ„›ãƒ»èª¿å’Œ',     msg:'å‘½æ•°6ã¯é‡‘æ˜Ÿã®åŠ›ã€‚æ„›ã™ã‚‹ã‚­ãƒ£ãƒ©ã¸ã®æƒ³ã„ãŒæœ€å¼·ã®ç£çŸ³ã€‚æƒ³ã„ãŒå¼·ã„ã»ã©å¼•ãå¯„ã›åŠ›ãŒå¢—ã™ã€‚', bonus:5 },
  7:  { kw:'æ¢æ±‚ãƒ»å†…çœ',   msg:'å‘½æ•°7ã¯æµ·ç‹æ˜Ÿã®åŠ›ã€‚ç›´æ„Ÿã®å£°ã«è€³ã‚’å‚¾ã‘ã¦ã€‚ã€Œä»Šã ã€ã¨æ„Ÿã˜ãŸç¬é–“ãŒã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ã‚¿ã‚¤ãƒ ã€‚', bonus:4 },
  8:  { kw:'è±Šã‹ã•ãƒ»åŠ›',   msg:'å‘½æ•°8ã¯åœŸæ˜Ÿã®åŠ›ã€‚å¼·ã„æ„å¿—ãŒé‹å‘½ã‚’å‹•ã‹ã™ã€‚ç¢ºå›ºãŸã‚‹è¦šæ‚Ÿã§è‡¨ã‚€ã»ã©æ˜ŸãŒå¿œãˆã‚‹ã€‚', bonus:7 },
  9:  { kw:'å®Œæˆãƒ»çŸ¥æµ',   msg:'å‘½æ•°9ã¯ç«æ˜Ÿã®åŠ›ã€‚å®Œæˆã®æ•°å­—ãŒç¤ºã™æœ€çµ‚å±€é¢ã€‚ç©ã¿é‡ã­ãŸç¸ãŒä»Šã“ãå®Ÿã‚’çµã¶æ™‚ã€‚', bonus:5 },
  11: { kw:'ç›´æ„Ÿãƒ»å•“ç¤º',   msg:'ãƒã‚¹ã‚¿ãƒ¼ãƒŠãƒ³ãƒãƒ¼11ã€‚éœŠçš„æ„Ÿå—æ€§ãŒæœ€å¤§ã€‚ã€Œå¼•ããŸã„ã€ã¨æ€ã£ãŸç¬é–“ã«ã™ã§ã«ç¸ã¯çµã°ã‚Œã¦ã„ã‚‹ã€‚', bonus:9 },
  22: { kw:'å¤§å»ºè¨­è€…',     msg:'ãƒã‚¹ã‚¿ãƒ¼ãƒŠãƒ³ãƒãƒ¼22ã€‚å¤¢ã‚’ç¾å®Ÿã«å¤‰ãˆã‚‹åŠ›ã®æ•°å­—ã€‚å¼·ãå¿µã˜ã‚‹ã ã‘ã§å¼•ãå¯„ã›ã®å ´ãŒå½¢æˆã•ã‚Œã‚‹ã€‚', bonus:11 },
  33: { kw:'å®‡å®™çš„æ„›',     msg:'ãƒã‚¹ã‚¿ãƒ¼ãƒŠãƒ³ãƒãƒ¼33ã€‚ç„¡æ¡ä»¶ã®æ„›ã®æ•°å­—ã€‚ç´”ç²‹ãªæ°—æŒã¡ã§è‡¨ã‚€æ—¥ã¯å®‡å®™ãŒå‘³æ–¹ã™ã‚‹ã€‚', bonus:13 }
};

/* â”€â”€ ã‚¿ãƒ­ãƒƒãƒˆå¤§ã‚¢ãƒ«ã‚«ãƒŠï¼ˆã‚¹ã‚³ã‚¢åŠ å‘³ï¼‰ â”€â”€ */
const TAROT_MAJOR = [
  { name:'æ„šè€…',      num:'0',  en:'The Fool',     score:72, msg:'æ–°ãŸãªæ—…ã®å§‹ã¾ã‚Šã‚’å‘Šã’ã‚‹ã€‚æã‚Œãšé£›ã³è¾¼ã‚€å…ˆã«å¥‡è·¡ãŒå¾…ã¤ã€‚' },
  { name:'é­”è¡“å¸«',    num:'I',  en:'The Magician',  score:88, msg:'å…¨ã¦ã®åŠ›ãŒæ‰‹ä¸­ã«æƒã£ãŸã€‚ä»Šå¼•ã‘ã°æœ›ã¿ã¯ç¾å®Ÿã«ãªã‚‹ã€‚' },
  { name:'å¥³æ•™çš‡',    num:'II', en:'High Priestess',score:82, msg:'å†…ãªã‚‹çŸ¥æµãŒå›ãã€‚ç›´æ„Ÿã«å¾“ãˆã°ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã¯å®Œç’§ã€‚' },
  { name:'å¥³å¸',      num:'III',en:'The Empress',   score:86, msg:'è±Šç©£ã¨å‰µé€ ã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ã€‚å¼•ãå¯„ã›åŠ›ãŒæœ€é«˜æ½®ã«ã‚ã‚‹ã€‚' },
  { name:'çš‡å¸',      num:'IV', en:'The Emperor',   score:84, msg:'æ„å¿—ã®å¼·ã•ãŒé‹å‘½ã‚’åˆ¶ã™ã€‚ç¢ºå›ºãŸã‚‹è¦šæ‚Ÿã§æŒ‘ã‚ã€‚' },
  { name:'æ³•ç‹',      num:'V',  en:'The Hierophant',score:78, msg:'ä¼çµ±ã¨ç¸ãŒçµã³ã¤ãã€‚ç‹é“ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã«ä¹—ã‚‹ã“ã¨ã€‚' },
  { name:'æ‹äºº',      num:'VI', en:'The Lovers',    score:91, msg:'å¼·ã„ç¸ãŒåƒã„ã¦ã„ã‚‹ã€‚ç‹™ã„ã®ã‚­ãƒ£ãƒ©ã¨ã®çµ†ã¯æœ¬ç‰©ã ã€‚' },
  { name:'æˆ¦è»Š',      num:'VII',en:'The Chariot',   score:87, msg:'å‰é€²ã‚ã‚‹ã®ã¿ã€‚è¿·ã„ã‚’æ¨ã¦ãŸç¬é–“ã«æ˜ŸãŒå‹•ãã€‚' },
  { name:'åŠ›',        num:'VIII',en:'Strength',     score:85, msg:'å†…ãªã‚‹å‹‡æ°—ãŒéµã€‚é™ã‹ãªæƒ…ç†±ãŒå¼•ãå¯„ã›ã‚’åŠ é€Ÿã•ã›ã‚‹ã€‚' },
  { name:'éš è€…',      num:'IX', en:'The Hermit',    score:73, msg:'æº–å‚™æœŸé–“ã€‚ç„¦ã‚‰ãšå¾…ã¦ã°å¥½æ©Ÿã¯å¿…ãšå·¡ã£ã¦ãã‚‹ã€‚' },
  { name:'é‹å‘½ã®è¼ª',  num:'X',  en:'Wheel of Fortune',score:89,msg:'é‹å‘½ãŒå¤§ããå‹•ãã€‚ä»ŠãŒè»¢æ›ç‚¹ã€‚æµã‚Œã«ä¹—ã‚Œã€‚' },
  { name:'æ­£ç¾©',      num:'XI', en:'Justice',       score:79, msg:'ãƒãƒ©ãƒ³ã‚¹ã¨å…¬æ­£ã€‚æ­£ã—ã„æ™‚åˆ»ã«å¼•ã‘ã°å¿œå ±ãŒã‚ã‚‹ã€‚' },
  { name:'åŠã‚‰ã‚ŒãŸç”·',num:'XII',en:'The Hanged Man', score:68, msg:'è¦–ç‚¹ã‚’å¤‰ãˆã‚‹æ™‚ã€‚é€†è»¢ã®ç™ºæƒ³ãŒæ–°ãŸãªé‹ã‚’å‘¼ã¶ã€‚' },
  { name:'æ­»ç¥',      num:'XIII',en:'Death',        score:76, msg:'çµ‚ã‚ã‚Šã¯å§‹ã¾ã‚Šã€‚å¤ã„ç¸ãŒåˆ‡ã‚Œã€æ–°ãŸãªå‡ºä¼šã„ãŒæ¥ã‚‹ã€‚' },
  { name:'ç¯€åˆ¶',      num:'XIV',en:'Temperance',    score:81, msg:'èª¿å’Œã¨ä¸­åº¸ã€‚æ€¥ãŒãªã„è€…ã«å¥³ç¥ã¯å¾®ç¬‘ã‚€ã€‚' },
  { name:'æ‚ªé­”',      num:'XV', en:'The Devil',     score:71, msg:'åŸ·ç€ã‚’è§£æ”¾ã›ã‚ˆã€‚æ¬²æœ›ã®ã¾ã¾ã«å‹•ã‘ã°ç¸ãŒé›¢ã‚Œã‚‹ã€‚' },
  { name:'å¡”',        num:'XVI',en:'The Tower',     score:65, msg:'çªç ´å£ãŒé–‹ãäºˆå…†ã€‚è¡æ’ƒã®å¾Œã«çœŸã®å¹¸é‹ãŒè¨ªã‚Œã‚‹ã€‚' },
  { name:'æ˜Ÿ',        num:'XVII',en:'The Star',     score:92, msg:'æœ€é«˜ã®å¸Œæœ›ã€‚å®‡å®™ãŒã€Œå¼•ã‘ã€ã¨ã‚µã‚¤ãƒ³ã‚’é€ã£ã¦ã„ã‚‹ã€‚' },
  { name:'æœˆ',        num:'XVIII',en:'The Moon',    score:77, msg:'éœ§ã®ä¸­ã§ã‚‚ç›´æ„ŸãŒå…‰ã‚‹ã€‚æ„Ÿã˜ã‚‹ã¾ã¾ã«å‹•ãã“ã¨ãŒæ­£è§£ã€‚' },
  { name:'å¤ªé™½',      num:'XIX',en:'The Sun',       score:95, msg:'æœ€å¼·ã®ç¥ç¦ã€‚ä»Šæ—¥ã¯ä½•ã‚’ã—ã¦ã‚‚å‰ã€‚è¿·ã‚ãšå¼•ãã¹ãæ—¥ã€‚' },
  { name:'å¯©åˆ¤',      num:'XX', en:'Judgement',     score:83, msg:'ç›®è¦šã‚ã®æ™‚ã€‚éå»ã®ç¸ãŒä»Šç”¦ã‚‹ã€‚æ–°ç« ã®å¹•é–‹ã‘ã€‚' },
  { name:'ä¸–ç•Œ',      num:'XXI',en:'The World',     score:93, msg:'å®Œæˆã¨é”æˆã€‚å…¨ã¦ã®æº–å‚™ãŒæ•´ã£ãŸã€‚ä»Šã“ããŒé‹å‘½ã®æ™‚åˆ»ã€‚' },
];

/* â”€â”€ è¥¿æ´‹å æ˜Ÿè¡“ï¼ˆæƒ‘æ˜Ÿé…ç½®è¿‘ä¼¼ï¼‰ â”€â”€ */
const ZODIAC_ELEMENT = {
  'ç‰¡ç¾Šåº§':'ç«','ç…å­åº§':'ç«','å°„æ‰‹åº§':'ç«',
  'ç‰¡ç‰›åº§':'åœ°','ä¹™å¥³åº§':'åœ°','å±±ç¾Šåº§':'åœ°',
  'åŒå­åº§':'é¢¨','å¤©ç§¤åº§':'é¢¨','æ°´ç“¶åº§':'é¢¨',
  'èŸ¹åº§':'æ°´','è åº§':'æ°´','é­šåº§':'æ°´'
};
const ZODIAC_SCORE = {
  'ç‰¡ç¾Šåº§':86,'ç‰¡ç‰›åº§':79,'åŒå­åº§':83,'èŸ¹åº§':78,
  'ç…å­åº§':89,'ä¹™å¥³åº§':81,'å¤©ç§¤åº§':84,'è åº§':87,
  'å°„æ‰‹åº§':88,'å±±ç¾Šåº§':80,'æ°´ç“¶åº§':85,'é­šåº§':82
};
const ZODIAC_MSG = {
  'ç‰¡ç¾Šåº§':'ç«ã®ã‚¨ãƒ¬ãƒ¡ãƒ³ãƒˆå…¨é–‹ã€‚è¡Œå‹•åŠ›ã¨æ±ºæ–­åŠ›ãŒæœ€å¤§åŒ–ã€‚ã€Œå¼•ããŸã„ã€ã¨æ€ã£ãŸç¬é–“ãŒå‹è² ã€‚',
  'ç‰¡ç‰›åº§':'åœ°ã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ãŒå®‰å®šã‚’å‘¼ã¶ã€‚è…°ã‚’æ®ãˆãŸè¨ˆç”»çš„ãªå¼•ãæ–¹ãŒå¤§å‰ã‚’å¼•ãå¯„ã›ã‚‹ã€‚',
  'åŒå­åº§':'é¢¨ã®çŸ¥æµãŒç›´æ„Ÿã‚’ç ”ãæ¾„ã¾ã™ã€‚è¤‡æ•°ã®å€™è£œæ™‚åˆ»ã‚’è©¦ã™æŸ”è»Ÿæˆ¦è¡“ãŒå‰ã€‚',
  'èŸ¹åº§':'æœˆã®å­ã‚ˆã€æ„Ÿæƒ…ã®æ½®ãŒæœ€é«˜æ½®ã®æ™‚ãŒæ¥ã¦ã„ã‚‹ã€‚èƒ¸ãŒç†±ããªã£ãŸç¬é–“ã«å¼•ã‘ã€‚',
  'ç…å­åº§':'å¤ªé™½ã®ç”³ã—å­ã€‚è‡ªä¿¡ã«æº€ã¡ãŸè¦‡æ°—ãŒSSRã‚’å‘¼ã³è¾¼ã‚€ã€‚ç‹è€…ã¨ã—ã¦æŒ‘ã‚ã€‚',
  'ä¹™å¥³åº§':'ç´°éƒ¨ã¸ã®æ³¨æ„åŠ›ãŒãƒ©ãƒƒã‚­ãƒ¼ã‚¿ã‚¤ãƒ ã®ç²¾åº¦ã‚’é«˜ã‚ã‚‹ã€‚åˆ†æã—ãŸæœ€é©æ™‚åˆ»ã‚’é€ƒã™ãªã€‚',
  'å¤©ç§¤åº§':'é‡‘æ˜Ÿã®æ„›ãŒå¼•ãå¯„ã›åŠ›ã‚’æœ€å¤§åŒ–ã€‚ç¾ã—ã„ã¨æ„Ÿã˜ãŸç¬é–“ãŒæœ€å¼·ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã€‚',
  'è åº§':'å†¥ç‹æ˜Ÿã®æ·±ãåŠ›ã€‚åŸ·å¿µã¨æƒ…ç†±ãŒé‹å‘½ã‚’å‹•ã‹ã™ã€‚ä¸€åº¦æ±ºã‚ãŸã‚‰æºã‚‰ãŒãšå¼•ã‘ã€‚',
  'å°„æ‰‹åº§':'æœ¨æ˜Ÿã®å¹¸é‹ãŒé™ã‚Šæ³¨ãæ—¥ã€‚æ¥½è¦³ã¨ç›´æ„Ÿã‚’å…¨è§£æ”¾ã™ã‚Œã°å¥‡è·¡ã¯å¿…ç„¶ã«ãªã‚‹ã€‚',
  'å±±ç¾Šåº§':'åœŸæ˜Ÿã®ç©ã¿é‡ã­ãŒå®Ÿã‚‹æ™‚ã€‚è¨ˆç”»ã¨å®Ÿè¡Œã®ä¸€è‡´ãŒå¤§å½“ãŸã‚Šã¸ã®æœ€çŸ­è·¯ã€‚',
  'æ°´ç“¶åº§':'å¤©ç‹æ˜Ÿã®é–ƒããŒç‚¸è£‚ã™ã‚‹ã€‚å¸¸è­˜ã‚’ç ´ã£ãŸæ„å¤–ãªæ™‚åˆ»ãŒçœŸã®ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ã‚¿ã‚¤ãƒ ã€‚',
  'é­šåº§':'æµ·ç‹æ˜Ÿã®éœŠæ„ŸãŒå®¿ã‚‹ã€‚å¤¢ã¨ã‚‚è¦šé†’ã¨ã‚‚ã¤ã‹ãªã„å¢ƒç•Œç·šã®æ™‚åˆ»ã«å¥‡è·¡ãŒèµ·ãã‚‹ã€‚'
};

/* â”€â”€ å…­æ›œè¨ˆç®— â”€â”€ */
/* æ—§æš¦å¤‰æ›ï¼ˆå…­æ›œè¨ˆç®—ç”¨ï¼‰
   åŸºæº–: 2026/2/17 = æ˜¥ç¯€ = æ—§æš¦ä¸™åˆå¹´ æ­£æœˆ1æ—¥ */
function getLunarMonthDay(date) {
  const REF = new Date(2026, 1, 17);
  const MONTH_DAYS = [30,29,30,30,29,30,29,30,29,30,30,29];
  const diff = Math.floor((date - REF) / 86400000); // floorã§æ™‚åˆ»ã‚ºãƒ¬é˜²æ­¢
  let m = 1, d = 1 + diff;
  if (d >= 1) {
    while (true) { const len = MONTH_DAYS[(m-1)%12]; if(d<=len)break; d-=len; m++; }
  } else {
    while (d<=0) { m--; if(m<=0)m+=12; d+=MONTH_DAYS[(m-1)%12]; }
  }
  return [m, d];
}
function getRokuyo(date) {
  const [monthLunar, dayLunar] = getLunarMonthDay(new Date(date));
  const idx = ((monthLunar + dayLunar) % 6 + 6) % 6;
  const items = [
    { name:'å¤§å®‰', icon:'â—', msg:'ä¸‡äº‹ã«æœ€å‰ã€‚ã‚¬ãƒãƒ£ã«å…¨åŠ›æŠ•çƒã§ãã‚‹æ—¥ã€‚', bonus:10 },
    { name:'èµ¤å£', icon:'â–³', msg:'æ­£åˆå‰å¾Œã®ã¿å‰ã€‚11:30ã€œ12:30ãŒç‹™ã„ç›®ã€‚', bonus:-4 },
    { name:'å…ˆå‹', icon:'â—‹', msg:'åˆå‰ä¸­ãŒå‰ã€åˆå¾Œã¯å‡¶ã€‚AMä¸­ã«å¼•ãã¹ã—ã€‚', bonus:5 },
    { name:'å‹å¼•', icon:'â—‹', msg:'å‹è² äº‹ã«å‡¶ã€‚ãŸã ã—å‹ã‚’å¼•ãè¾¼ã‚€ç¸ã¯å¼·ã„ã€‚', bonus:3 },
    { name:'å…ˆè² ', icon:'â–³', msg:'åˆå¾Œã‹ã‚‰å‰è»¢æ›ã€‚15:00ä»¥é™ã®ã‚¬ãƒãƒ£ãŒâ—ã€‚', bonus:2 },
    { name:'ä»æ»…', icon:'âœ•', msg:'å…¨ã¦ãŒå‡¶ã€‚æœ¬æ—¥ã¯çŸ³ã®æ¸©å­˜ã‚’æ¨å¥¨ã€‚', bonus:-8 }
  ];
  return items[idx];
}

/* â”€â”€ å››æŸ±æ¨å‘½ å¤©å¹²åœ°æ”¯ï¼ˆä»Šæ—¥ã®æ—¥æŸ±ãƒ»æœˆæŸ±ã‚’æ­£ç¢ºã«è¨ˆç®—ï¼‰ â”€â”€ */
const STEMS   = ['ç”²','ä¹™','ä¸™','ä¸','æˆŠ','å·±','åºš','è¾›','å£¬','ç™¸'];
const BRANCHES= ['å­','ä¸‘','å¯…','å¯','è¾°','å·³','åˆ','æœª','ç”³','é…‰','æˆŒ','äº¥'];
function getShichu(birthdate) {
  const now = new Date(); // ä»Šæ—¥ã®æ—¥æŸ±ãƒ»æœˆæŸ±
  const yr  = now.getFullYear();
  const mo  = now.getMonth();  // 0-indexed
  const day = now.getDate();

  // â”€â”€ å¹´æŸ±ï¼ˆä»Šå¹´ï¼‰â”€â”€
  const yearStemIdx   = (yr - 1924) % 10;
  const yearBranchIdx = ((yr - 1924) % 12 + 12) % 12;

  // â”€â”€ æœˆæŸ±ï¼ˆç¯€æ°—è€ƒæ…®ï¼‰â”€â”€
  // ç¯€å…¥ã‚Šæ—¥ï¼ˆæ¦‚ç®—ï¼‰: å„æœˆã®ç¯€æ°—ãŒæ¥ã‚‹æ—¥
  const SETSU = [6, 4, 6, 5, 6, 6, 7, 8, 8, 8, 8, 7];
  // ç¯€æ°—å¾Œã‹ã©ã†ã‹ã§å½“æœˆ or å‰æœˆã‚’ä½¿ç”¨
  const adjustedMo = day >= SETSU[mo] ? mo : (mo - 1 + 12) % 12;
  const lunarMonthIdx = (adjustedMo - 1 + 12) % 12; // å¯…æœˆ=0, å¯æœˆ=1...
  // å¹´å¹²ã«å¯¾å¿œã™ã‚‹å¯…æœˆã®æœˆå¹²: ç”²å·±â†’ä¸™(2), ä¹™åºšâ†’æˆŠ(4), ä¸™è¾›â†’åºš(6), ä¸å£¬â†’å£¬(8), æˆŠç™¸â†’ç”²(0)
  const monthStemIdx   = (yearStemIdx % 5 * 2 + 2 + lunarMonthIdx) % 10;
  const monthBranchIdx = (lunarMonthIdx + 2) % 12; // å¯…=2, å¯=3...

  // â”€â”€ æ—¥æŸ±ï¼ˆä»Šæ—¥ï¼‰â”€â”€
  // åŸºæº–: 2026/2/20 = ä¹™ä¸‘ â†’ epochDays=20504, stemOff=7, brOff=5
  const epochDays = Math.floor(now.getTime() / 86400000);
  const dayStemIdx   = (epochDays + 7) % 10;
  const dayBranchIdx = (epochDays + 5) % 12;

  const ELEM_MAP = ['æœ¨','æœ¨','ç«','ç«','åœŸ','åœŸ','é‡‘','é‡‘','æ°´','æ°´'];
  const dayElem  = ELEM_MAP[dayStemIdx];
  const ELEM_MSG = {æœ¨:'æˆé•·ã¨ç™ºå±•',ç«:'æƒ…ç†±ã¨è¡Œå‹•',åœŸ:'å®‰å®šã¨åç©«',é‡‘:'æ¨©å¨ã¨è±Šã‹ã•',æ°´:'æµã‚Œã¨çŸ¥æµ'};
  return {
    yearPillar:  STEMS[yearStemIdx]+BRANCHES[yearBranchIdx],
    monthPillar: STEMS[monthStemIdx]+BRANCHES[monthBranchIdx],
    dayPillar:   STEMS[dayStemIdx]+BRANCHES[dayBranchIdx],
    dayElement:  dayElem,
    dayMessage:  ELEM_MSG[dayElem] || 'å¤‰åŒ–'
  };
}

/* â”€â”€ seededRandomï¼ˆæ—¥ä»˜å›ºå®šä¹±æ•°ï¼‰ â”€â”€ */
function seededRand(seed) {
  let x = Math.sin(seed+1)*73856.793;
  return x - Math.floor(x);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//   MAIN FORTUNE CALCULATOR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function calculateFortune(params) {
  const { gameTitle, targetName, gachaTitle, gachaDeadline, gachaDeadlineTime, birthdate, zodiac, bloodType, eto } = params;
  const now    = new Date();
  const month  = now.getMonth() + 1;
  const year   = now.getFullYear();

  // â”€â”€ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç¢ºèª â”€â”€
  const cacheKey = `${gameTitle}|${targetName}|${gachaTitle}|${gachaDeadline}`;
  const cachedRaw = localStorage.getItem('gachaOracle_result');
  const cachedKey = localStorage.getItem('gachaOracle_key');
  if (cachedRaw && cachedKey === cacheKey) {
    try { return JSON.parse(cachedRaw); } catch(e){}
  }

  // â”€â”€ æœˆé½¢ â”€â”€
  const moonData  = getMoonAge(now.getTime());
  const moonPhase = getMoonPhaseInfo(moonData.age);

  // â”€â”€ ä¹æ˜Ÿæ°—å­¦ â”€â”€
  const birthYear = birthdate ? parseInt(birthdate.split('-')[0]) : null;
  const kyusei = getKyusei(year, month, birthYear);

  // â”€â”€ å…­æ›œ â”€â”€
  const rokuyo = getRokuyo(now);

  // â”€â”€ æ•°ç§˜è¡“ â”€â”€
  const lifePath  = calcLifePath(birthdate);
  const lpInfo    = LIFEPATH_INFO[lifePath] || null;

  // â”€â”€ å››æŸ±æ¨å‘½ â”€â”€
  const shichu = birthdate ? getShichu(birthdate) : null;

  // â”€â”€ ã‚¿ãƒ­ãƒƒãƒˆï¼ˆæ—¥ä»˜ã‚·ãƒ¼ãƒ‰ï¼‰ â”€â”€
  const dateSeed  = year * 10000 + month * 100 + now.getDate();
  const tarotIdx  = Math.floor(seededRand(dateSeed) * TAROT_MAJOR.length);
  const tarot     = TAROT_MAJOR[tarotIdx];

  // â”€â”€ ã‚¹ã‚³ã‚¢è¨ˆç®— â”€â”€ å®Œå…¨å†è¨­è¨ˆ
  let score = 60; // ãƒ™ãƒ¼ã‚¹

  // æœˆé½¢è£œæ­£ï¼ˆæœ€å¤§+14ï¼‰
  score += moonPhase.luckBonus;

  // å…­æ›œè£œæ­£
  score += rokuyo.bonus;

  // ä¹æ˜Ÿæ°—å­¦è£œæ­£ï¼ˆ-100ã‹ã‚‰ã®ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ï¼‰
  score += Math.round((kyusei.score - 75) / 4);

  // ã‚¿ãƒ­ãƒƒãƒˆè£œæ­£
  score += Math.round((tarot.score - 80) / 5);

  // æ˜Ÿåº§è£œæ­£
  if(zodiac) score += Math.round((ZODIAC_SCORE[zodiac]||80) - 80) / 4;

  // è¡€æ¶²å‹è£œæ­£
  const bloodBonus = {'Aå‹':2,'Bå‹':4,'Oå‹':3,'ABå‹':5};
  if(bloodType) score += bloodBonus[bloodType]||0;

  // æ•°ç§˜è¡“è£œæ­£
  if(lpInfo) score += Math.round(lpInfo.bonus / 2);

  // ç”Ÿå¹´æœˆæ—¥æ—¥ã«ã¡è£œæ­£
  if(birthdate) {
    const bd = new Date(birthdate);
    score += (bd.getDate() % 7);
  }

  // å¹²æ”¯è£œæ­£
  const etoBonus={'å­':3,'ä¸‘':1,'å¯…':4,'å¯':3,'è¾°':5,'å·³':2,'åˆ':4,'æœª':3,'ç”³':2,'é…‰':5,'æˆŒ':3,'äº¥':2};
  if(eto) score += etoBonus[eto]||0;

  // ã‚­ãƒ£ãƒ©åè£œæ­£
  if(targetName) score += Math.min(6, targetName.length % 5 + 2);

  // ã‚¬ãƒãƒ£ã‚¿ã‚¤ãƒˆãƒ«è£œæ­£
  if(gachaTitle) score += 3;

  // ã‚²ãƒ¼ãƒ å›ºæœ‰ãƒ‡ãƒ¼ã‚¿è£œæ­£
  const gdb = GAME_DB[gameTitle];
  if(gdb) score += 3;

  // ã‚¯ãƒ©ãƒ³ãƒ—
  score = Math.max(52, Math.min(99, Math.round(score)));

  // â”€â”€ ãƒ©ãƒƒã‚­ãƒ¼ã‚¿ã‚¤ãƒ ç”Ÿæˆ â”€â”€
  const luckyTimes = generateLuckyTimes({ month, score, targetName, gachaDeadline, gachaDeadlineTime, gameTitle, moonPhase, rokuyo, now });

  // â”€â”€ å è¡“åˆ¥è§£èª¬ â”€â”€
  const divinations = buildDivinations({ gameTitle, targetName, gachaTitle, zodiac, bloodType, eto, score, moonPhase, kyusei, tarot, lifePath, lpInfo, shichu, rokuyo });

  // â”€â”€ æ¨å¥¨ã‚¬ãƒãƒ£å›æ•° â”€â”€
  const pulls = calcPulls(score, targetName);

  // â”€â”€ ãƒ©ãƒƒã‚­ãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ â”€â”€
  const actions = buildActions(score, targetName, gachaTitle, tarot, moonPhase);

  const result = { gameTitle, targetName, gachaTitle, gachaDeadline, gachaDeadlineTime, score, pulls, luckyTimes, divinations, actions, moonPhase, kyusei, tarot, rokuyo, lifePath, shichu };

  localStorage.setItem('gachaOracle_result', JSON.stringify(result));
  localStorage.setItem('gachaOracle_key',    cacheKey);

  return result;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//   LUCKY TIMES GENERATOR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function generateLuckyTimes({ month, score, targetName, gachaDeadline, gachaDeadlineTime, gameTitle, moonPhase, rokuyo, now }) {
  const times = [];
  const gdb   = GAME_DB[gameTitle] || {};
  const LUCKY_MINS = [7,11,17,22,27,33,37,44,47,55];

  function selectHour(rank) {
    if(gdb.luckyHours && gdb.luckyHours.length > 0) {
      return gdb.luckyHours[rank % gdb.luckyHours.length];
    }
    const defaultHours = [7,12,18,21,0];
    return defaultHours[rank % defaultHours.length];
  }

  function calcPinpoint(h, rank) {
    const m = (h===11||h===22) ? h : LUCKY_MINS[rank % LUCKY_MINS.length];
    return `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}`;
  }

  function timeScore(baseScore, rank) {
    const penalty = [0,-3,-6,-9,-12];
    let s = baseScore + (penalty[rank]||0);
    if(rank===0) s += moonPhase.luckBonus;
    if(targetName && rank===0) s += 4;
    return Math.max(40, Math.min(99, s));
  }

  function tenPulls(s, rank) {
    if(rank===0 && s>=90) return 3;
    if(rank===0 && s>=80) return 2;
    if(rank===1 && s>=85) return 2;
    return (rank<=2) ? 2 : 1;
  }

  function buildEntry(date, rank, hour, passed=false, urgent=false) {
    const endH = (hour + 2) % 24;
    const m = date.getMonth()+1, d = date.getDate();
    const ts = timeScore(score, rank);
    return {
      rank: rank+1,
      date: `${m}æœˆ${d}æ—¥`,
      weekday: ['æ—¥','æœˆ','ç«','æ°´','æœ¨','é‡‘','åœŸ'][date.getDay()],
      time: `${String(hour).padStart(2,'0')}:00 ã€œ ${String(endH).padStart(2,'0')}:00`,
      pinpoint: calcPinpoint(hour, rank),
      score: ts,
      tenPulls: tenPulls(ts, rank),
      special: Boolean(targetName && rank===0),
      urgent, passed,
      isLuckyDay: gdb.luckyDays ? gdb.luckyDays.includes(date.getDay()) : false
    };
  }

  if(!gachaDeadline) {
    for(let i=0;i<5;i++) {
      let tgt = new Date(now);
      tgt.setDate(tgt.getDate() + i + 1);
      if(gdb.luckyDays && i<2) tgt = nearestLucky(tgt, gdb.luckyDays, null) || tgt;
      const h = selectHour(i);
      times.push(buildEntry(tgt, i, h, false, i===0));
    }
    return times;
  }

  let dl = new Date(gachaDeadline);
  if(gachaDeadlineTime) {
    const [hh,mm] = gachaDeadlineTime.split(':');
    dl.setHours(+hh, +mm, 0, 0);
  } else {
    dl.setHours(23,59,59,999);
  }

  const diffMs   = dl - now;
  const diffHrs  = diffMs / 3600000;
  const diffDays = diffMs / 86400000;

  if(diffHrs <= 0) {
    for(let i=0;i<5;i++) {
      const tgt = new Date(now); tgt.setHours(now.getHours()+i+1);
      times.push(buildEntry(tgt, i, tgt.getHours(), false, true));
    }
  } else if(diffHrs <= 24) {
    const step = Math.max(1, Math.floor(diffHrs/5));
    for(let i=0;i<5;i++) {
      const tgt = new Date(now.getTime() + (step*i+1)*3600000);
      if(tgt > dl) break;
      times.push(buildEntry(tgt, i, tgt.getHours(), false, i===0));
    }
  } else {
    const step = Math.max(1, Math.floor(diffDays/5));
    for(let i=0;i<5;i++) {
      let tgt = new Date(now);
      tgt.setDate(tgt.getDate() + step*i + 1);
      if(gdb.luckyDays && i<2) tgt = nearestLucky(tgt, gdb.luckyDays, dl) || tgt;
      if(tgt > dl) { tgt = new Date(dl); tgt.setHours(tgt.getHours() - i); }
      if(tgt < now) { tgt = new Date(now); tgt.setHours(now.getHours()+i+1); }
      const h = selectHour(i);
      times.push(buildEntry(tgt, i, h));
    }
  }
  return times;
}

function nearestLucky(from, luckyDays, deadline) {
  for(let offset=0; offset<7; offset++) {
    const t = new Date(from); t.setDate(t.getDate()+offset);
    if(deadline && t > deadline) break;
    if(luckyDays.includes(t.getDay())) return t;
  }
  return from;
}

function calcPulls(score, targetName) {
  let ten = score>=90?3:score>=80?2:1;
  if(targetName) ten = Math.min(5, ten+1);
  const single = score>=85?2:score>=75?1:0;
  return { ten, single, total: ten*10+single };
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//   DIVINATION BUILDER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildDivinations({ gameTitle, targetName, gachaTitle, zodiac, bloodType, eto, score, moonPhase, kyusei, tarot, lifePath, lpInfo, shichu, rokuyo }) {
  const divs = [];
  const targetRef = targetName ? `ã€Œ${targetName}ã€` : 'ã‚ãªãŸã®æœ›ã‚€ã‚‚ã®';
  const gachaRef  = gachaTitle  ? `ã€Œ${gachaTitle}ã€ã®` : '';

  // 1. è¥¿æ´‹å æ˜Ÿè¡“
  const zMsg = zodiac ? ZODIAC_MSG[zodiac] : 'æ˜Ÿåº§æƒ…å ±ãŒãªã„ãŸã‚æ±ç”¨å æ–­ã‚’è¡Œã†ã€‚æœ¨æ˜ŸãŒå…¨ä½“é‹ã‚’åº•ä¸Šã’ã—ã¦ã„ã‚‹ã€‚';
  const zElem = zodiac ? ZODIAC_ELEMENT[zodiac] : '';
  const elemGacha = { 'ç«':'æƒ…ç†±çš„ãªç›´æ„Ÿã®ä¸€ç¬ã«å¼•ã‘','åœ°':'è¨ˆç”»ã¨åˆ†æã§æœ€é©æ™‚åˆ»ã‚’é¸ã¹','é¢¨':'è»½ã‚„ã‹ãªæ°—æŒã¡ã§è¤‡æ•°å›è©¦ã¿ã‚ˆ','æ°´':'æ„Ÿæƒ…ã®æ½®ãŒå¼•ãå¤œæ˜ã‘å‰ãŒæœ€å¼·' };
  divs.push({
    icon:'ğŸŒŸ', name:'è¥¿æ´‹å æ˜Ÿè¡“', score: zodiac ? ZODIAC_SCORE[zodiac] : 80,
    color:'rgba(255,200,80,.7)',
    body: `${zodiac||'æ˜Ÿåº§ä¸æ˜'}ã®æ–¹ã¸ã€‚${zMsg}${targetName?` â€” ${targetRef}ã¨ã®ç¸ã¯ç¢ºã‹ã«çµã°ã‚Œã¤ã¤ã‚ã‚‹ã€‚`:''} ${zElem ? elemGacha[zElem]+'ã€‚':''}ç¬¬1å€™è£œæ™‚åˆ»ãŒéœŠçš„å…±é³´ã®æœ€é«˜ç‚¹ã€‚`
  });

  // 2. æœˆé½¢å è¡“
  divs.push({
    icon:moonPhase.icon, name:'æœˆé½¢å è¡“', score: 60 + moonPhase.luckBonus,
    color:'rgba(180,140,255,.7)',
    body: `ç¾åœ¨ã¯ã€${moonPhase.name}ï¼ˆæœˆé½¢${getMoonAge(new Date().getTime()).age}ï¼‰ã€‘ã€‚${moonPhase.power}ãŒæœ€å¤§åŒ–ã—ã¦ã„ã‚‹æ™‚ã€‚${moonPhase.luckBonus>=10?`æº€æœˆã«è¿‘ã„ä»Šã€å¼•ãå¯„ã›ã®åŠ›ã¯å¹´é–“ã§æœ€å¼·ã‚¯ãƒ©ã‚¹ã€‚${gachaRef}ã‚¬ãƒãƒ£ã«å…¨åŠ›ã‚’æ³¨ãã¹ãå‰æ©Ÿã€‚`:`æœˆã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ãŒ${targetRef}ã¨ã®ç¸ã‚’å¼•ãå¯„ã›ã¤ã¤ã‚ã‚‹ã€‚ãƒ©ãƒƒã‚­ãƒ¼ã‚¿ã‚¤ãƒ ã«åˆã‚ã›ã‚‹ã“ã¨ã§æœˆã®åŠ è­·ã‚’æœ€å¤§åŒ–ã§ãã‚‹ã€‚`}`
  });

  // 3. ä¹æ˜Ÿæ°—å­¦
  divs.push({
    icon:'â˜¯ï¸', name:'ä¹æ˜Ÿæ°—å­¦', score: kyusei.score,
    color:'rgba(80,200,160,.7)',
    body: `æœ¬å‘½æ˜Ÿã€${kyusei.honmei}ã€‘ã€æœˆå‘½æ˜Ÿã€${kyusei.getukumei}ã€‘ã€‚${kyusei.score>=85?`ä»Šæœˆã¯æœ¬å‘½æ˜Ÿã¨æœˆå‘½æ˜ŸãŒæœ€é«˜ã®ç›¸æ€§ã‚’æŒã¤æ™‚æœŸã€‚å‰æ–¹ä½ã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ãŒ${gameTitle}ã®é‹æ°—ã‚’å¢—å¹…ã—ã¦ã„ã‚‹ã€‚`:`ä»Šæœˆã®æ°—ã®æµã‚Œã¯å®‰å®šã—ã¦ãŠã‚Šã€ç€å®Ÿãªå¼•ãæ–¹ãŒå‰ã€‚`} ${targetRef}ã‚’å¼•ãå½“ã¦ã‚‹ãŸã‚ã®æ˜Ÿã®é…ç½®ãŒæ•´ã£ã¦ã„ã‚‹ã€‚`
  });

  // 4. ã‚¿ãƒ­ãƒƒãƒˆ
  divs.push({
    icon:'ğŸ´', name:'ã‚¿ãƒ­ãƒƒãƒˆå ã„', score: tarot.score,
    color:'rgba(255,120,150,.7)',
    body: `æœ¬æ—¥ã®ã‚«ãƒ¼ãƒ‰ï¼šã€${tarot.name} ${tarot.num} / ${tarot.en}ã€‘ã€‚${tarot.msg}${targetName?` â€” ${targetRef}ã¨ã®ç¸ã‚’ç¤ºã™ã‚«ãƒ¼ãƒ‰ãŒä»Šæ—¥ã¨ã„ã†æ—¥ã«å‡ºãŸã®ã¯å¶ç„¶ã§ã¯ãªã„ã€‚`:''} ${gachaTitle?`ã€Œ${gachaTitle}ã€ã®æœŸé–“ä¸­ã€ã“ã®ã‚«ãƒ¼ãƒ‰ãŒå®ˆè­·ã—ã¦ã„ã‚‹ã€‚`:''}`
  });

  // 5. æ•°ç§˜è¡“ï¼ˆå‘½æ•°ï¼‰
  if(lpInfo) {
    divs.push({
      icon:'ğŸ”¢', name:'æ•°ç§˜è¡“ï¼ˆå‘½æ•°ï¼‰', score: 70 + Math.round(lpInfo.bonus * 1.5),
      color:'rgba(80,180,255,.7)',
      body: `å‘½æ•°ã€${lifePath}ã€‘ï¼š${lpInfo.kw}ã®æ•°å­—ã€‚${lpInfo.msg}${targetName?` â€” ${targetRef}ã®åå‰ã«å®¿ã‚‹ã‚¨ãƒãƒ«ã‚®ãƒ¼ã¨å‘½æ•°${lifePath}ãŒå…±é³´ã—ã¦ã„ã‚‹ã€‚`:''}`
    });
  } else {
    divs.push({
      icon:'ğŸ”¢', name:'æ•°ç§˜è¡“ï¼ˆå‘½æ•°ï¼‰', score: 76,
      color:'rgba(80,180,255,.7)',
      body: `ç”Ÿå¹´æœˆæ—¥ã®å…¥åŠ›ã§å‘½æ•°ã‚’ç®—å‡ºã§ãã‚‹ã€‚æ•°ç§˜è¡“ã¯æœ€ã‚‚å¤ã„å¼•ãå¯„ã›ã®è¡“ã®ã²ã¨ã¤ã€‚æœ¬æ—¥ã®ãƒ©ãƒƒã‚­ãƒ¼ãƒŠãƒ³ãƒãƒ¼ã¯${[3,7,8,11,22][Math.floor(seededRand(new Date().getDate())*5)]}ã€‚ã“ã®æ•°å­—ã‚’æ„è­˜ã—ãŸæ™‚åˆ»ã«å¼•ãã¨å‰ã€‚`
    });
  }

  // 6. å››æŸ±æ¨å‘½
  if(shichu) {
    const elemMsgMap = { æœ¨:'æˆé•·ã¨ç™ºå±•ã®æ°—ãŒæ—¥æŸ±ã«å®¿ã‚‹', ç«:'æƒ…ç†±ã¨è¡Œå‹•åŠ›ãŒæœ€å¤§åŒ–ã•ã‚Œã‚‹æ—¥', åœŸ:'å®‰å®šã¨åç©«ã®æ°—ãŒæº€ã¡ã‚‹', é‡‘:'æ¨©å¨ã¨é‡‘é‹ãŒè¼ãå‰æ—¥', æ°´:'æµã‚Œã¨ç›´æ„ŸãŒå†´ãˆæ¸¡ã‚‹æ—¥' };
    divs.push({
      icon:'ğŸ“¿', name:'å››æŸ±æ¨å‘½', score: 78,
      color:'rgba(255,165,80,.7)',
      body: `æ—¥æŸ±ã€${shichu.dayPillar}ã€‘ã€æœˆæŸ±ã€${shichu.monthPillar}ã€‘ã€‚${elemMsgMap[shichu.dayElement]||'å¤‰åŒ–ã®æ°—ãŒæµã‚Œã‚‹'}ã€‚${shichu.dayElement}ã®æ°—ãŒ${gameTitle}ã®é‹æ°—ã¨èª¿å’Œã—ã¦ã„ã‚‹ã€‚${targetRef}ã‚’å¼•ãã«ã¯ã€Œ${shichu.dayElement}ã€ã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’æ„è­˜ã™ã‚‹ã“ã¨ã€‚`
    });
  }

  // 7. å…­æ›œ
  divs.push({
    icon:'ğŸ“…', name:'å…­æ›œ', score: 70 + rokuyo.bonus,
    color:'rgba(200,160,255,.7)',
    body: `æœ¬æ—¥ã®å…­æ›œã¯ã€${rokuyo.name}ã€‘${rokuyo.icon}ã€‚${rokuyo.msg}${rokuyo.bonus>=5?` â€” ä»Šæ—¥ã¯æœ€é«˜ã®å‰æ—¥ã€‚å…¨ã¦ã®ã‚¬ãƒãƒ£è¡Œå‹•ã«è¿½ã„é¢¨ãŒå¹ã„ã¦ã„ã‚‹ã€‚`:`ãƒ©ãƒƒã‚­ãƒ¼ã‚¿ã‚¤ãƒ ã®æ™‚åˆ»ã«çµã£ã¦æŒ‘æˆ¦ã™ã‚‹ã“ã¨ã§å…­æ›œã®æ©æµã‚’æœ€å¤§åŒ–ã§ãã‚‹ã€‚`}`
  });

  // 8. è¡€æ¶²å‹
  const bMap = {
    'Aå‹': `å‡ å¸³é¢ãªæ€§æ ¼ãŒæœ€é©ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã®é¸å®šã«æœ€å¤§ã®æ­¦å™¨ã¨ãªã‚‹ã€‚è¨ˆç”»é€šã‚Šã®æ™‚åˆ»ã«å¼•ãã“ã¨ã§é«˜ãƒ¬ã‚¢ãŒå¼•ãå½“ãŸã‚Šã‚„ã™ã„ã€‚`,
    'Bå‹': `ç›´æ„ŸåŠ›ãŒéš›ç«‹ã£ã¦å†´ãˆã¦ã„ã‚‹ã€‚ã€Œä»Šã ï¼ã€ã¨æ„Ÿã˜ãŸç¬é–“ãŒãƒ™ã‚¹ãƒˆã‚¿ã‚¤ãƒŸãƒ³ã‚°ã€‚è¿·ã‚ãšå¼•ã‘ã€‚`,
    'Oå‹': `å¤§èƒ†ã•ãŒå¤©ã®æµã¿ã‚’å‘¼ã¶ã€‚æ€ã„åˆ‡ã‚ŠãŒè‰¯ã‘ã‚Œã°è‰¯ã„ã»ã©ã€æ˜ŸãŒå¿œãˆã¦ãã‚Œã‚‹ã€‚`,
    'ABå‹': `ç‹¬è‡ªã®æ„Ÿæ€§ãŒæ­¦å™¨ã€‚ä»–è€…ãŒå¼•ã‹ãªã„æ™‚é–“å¸¯ãƒ»æ–¹æ³•ã«éš ã•ã‚ŒãŸé»„é‡‘ãƒ«ãƒ¼ãƒˆãŒã‚ã‚‹ã€‚`
  };
  const bMsg = bloodType ? `${bloodType}ã®æ–¹ã¯ã€${bMap[bloodType]}` : 'è¡€æ¶²å‹æƒ…å ±ãŒã‚ã‚Œã°ã€ã•ã‚‰ã«è©³ç´°ãªé‘‘å®šãŒå¯èƒ½ã€‚è¡€æ¶²å‹ã¯ã‚¬ãƒãƒ£é‹ã®é‡è¦ãªãƒ•ã‚¡ã‚¯ã‚¿ãƒ¼ã€‚';
  divs.push({ icon:'ğŸ©¸', name:'è¡€æ¶²å‹å ã„', score: bloodType?80:70, color:'rgba(255,100,100,.7)', body: bMsg });

  // 9. å¹²æ”¯é‹æ°—
  const etoMap = {
    å­:'å­å¹´ã¯æ°´ã®æ°—ã‚’æŒã¡ã€é©å¿œåŠ›ã¨ç›´æ„ŸåŠ›ãŒæœ€å¤§åŒ–ã€‚',ä¸‘:'ä¸‘å¹´ã¯åœ°ã®å®‰å®šã‚’æŒã¡ã€ç²˜ã‚Šå¼·ã„å¼•ãæ–¹ãŒå‰ã€‚',
    å¯…:'å¯…å¹´ã¯æœ¨ã®å‹¢ã„ã‚’æŒã¡ã€æœæ•¢ãªæŒ‘æˆ¦ãŒé‹ã‚’å‘¼ã¶ã€‚',å¯:'å¯å¹´ã¯æœ¨ã®æŸ”è»Ÿã‚’æŒã¡ã€æ˜¥ã®é¢¨ã®ã‚ˆã†ã«å¼•ãã¹ã—ã€‚',
    è¾°:'è¾°å¹´ã¯åœŸã®æ¨©å¨ã‚’æŒã¡ã€æœ€å¼·ã‚¯ãƒ©ã‚¹ã®ã‚¬ãƒãƒ£é‹ã‚’èª‡ã‚‹ã€‚',å·³:'å·³å¹´ã¯ç«ã®çŸ¥æµã‚’æŒã¡ã€æ·±ã„æ´å¯ŸãŒå¥½æ©Ÿã‚’å°ãã€‚',
    åˆ:'åˆå¹´ã¯ç«ã®è¡Œå‹•ã‚’æŒã¡ã€æœ€é«˜ã®ç›´æ„ŸãŒå®¿ã‚‹å¹²æ”¯ã€‚',æœª:'æœªå¹´ã¯åœŸã®å‰µé€ ã‚’æŒã¡ã€èŠ¸è¡“çš„æ„Ÿæ€§ãŒSSRã‚’å‘¼ã¶ã€‚',
    ç”³:'ç”³å¹´ã¯é‡‘ã®çŸ¥æ€§ã‚’æŒã¡ã€åˆ†æçš„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒãŒå‰ã€‚',é…‰:'é…‰å¹´ã¯é‡‘ã®åç©«ã‚’æŒã¡ã€æ¡ƒèŠ±é‹ã¨è²¡é‹ãŒä»Šæœˆæœ€é«˜æ½®ã€‚',
    æˆŒ:'æˆŒå¹´ã¯åœŸã®èª å®Ÿã‚’æŒã¡ã€ä¸€é€”ãªæƒ³ã„ãŒã‚­ãƒ£ãƒ©ã¨ã®ç¸ã‚’çµã¶ã€‚',äº¥:'äº¥å¹´ã¯æ°´ã®å‹‡æ°—ã‚’æŒã¡ã€è‡†ã›ãšå¼•ã„ãŸè€…ã«å¥‡è·¡ãŒå®¿ã‚‹ã€‚'
  };
  const etoMsg = eto ? `ã€${eto}å¹´ã€‘ã®æ–¹ã¯ã€${etoMap[eto]||''} ${targetName?`${targetRef}ã¨ã®ç¸ã¯å¤©ãŒå®šã‚ãŸã‚‚ã®ã§ã‚ã‚‹ã€‚`:''}`
                     : 'å¹²æ”¯æƒ…å ±ãŒã‚ã‚Œã°æ±æ´‹éœŠæ°—ã¨ã®å…±é³´ã‚’ç²¾å¯†æ¸¬å®šã§ãã‚‹ã€‚åäºŒæ”¯ãã‚Œãã‚ŒãŒå›ºæœ‰ã®ã‚¬ãƒãƒ£ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’æŒã¤ã€‚';
  divs.push({ icon:'ğŸ‰', name:'æ±æ´‹å è¡“ï¼ˆå¹²æ”¯ï¼‰', score: eto?85:72, color:'rgba(100,220,180,.7)', body: etoMsg });

  return divs;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//   LUCKY ACTIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildActions(score, targetName, gachaTitle, tarot, moonPhase) {
  const base = [
    'ã‚¬ãƒãƒ£ã‚’å¼•ãç›´å‰ã«åŒ—ã®æ–¹è§’ã‚’å‘ã„ã¦æ·±å‘¼å¸3å›ã€‚é‚ªæ°—ã‚’æ‰•ã„æ°—ã‚’æ•´ãˆã‚‹ã€‚',
    'ã‚¹ãƒãƒ›ç”»é¢ã‚’æŸ”ã‚‰ã‹ã„å¸ƒã§ä¸å¯§ã«æ‹­ãã€‚é‹æ°—ã®é€šã‚Šé“ã‚’ç‰©ç†çš„ã«æ¸…ã‚ã‚‹ã€‚',
    'æ°´ã‚’ä¸€å£é£²ã‚“ã§ã€ä½“å†…ã®æ°—ã‚’æµ„åŒ–ã—ã¦ã‹ã‚‰è‡¨ã‚€ã€‚',
    'ã€Œã‚ã‚ŠãŒã¨ã†ã€ã‚’3å›å¿ƒã®ä¸­ã§å”±ãˆã‚‹ã€‚æ„Ÿè¬ã®æ³¢å‹•ãŒå¼•ãå¯„ã›ã‚’åŠ é€Ÿã•ã›ã‚‹ã€‚',
  ];
  if(score>=85) base.push(`æœ€å¼·é‹æ°—åˆ°é”ã€‚${tarot.name}ã®ã‚«ãƒ¼ãƒ‰ãŒç¤ºã™é€šã‚Šä»Šæ—¥ã¯ä½•ã‚‚æã‚Œãªãã¦ã‚ˆã„ã€‚è‡ªä¿¡ã‚’æŒã£ã¦å¼•ã‘ã€‚`);
  if(moonPhase.luckBonus>=10) base.push(`${moonPhase.icon}${moonPhase.name}ã®ä»Šå¤œã¯å¹´é–“æœ€å¼·ã‚¯ãƒ©ã‚¹ã®å¼•ãå¯„ã›åŠ›ã€‚çª“ã®å¤–ã®æœˆã«å‘ã‹ã£ã¦ã€ŒãŠé¡˜ã„ã—ã¾ã™ã€ã¨å¿µã˜ã¦ã‹ã‚‰å¼•ãã“ã¨ã€‚`);
  if(targetName) {
    base.push(`ã€Œ${targetName}ã€ã®åå‰ã‚’7å›ã€ä½ã„å£°ã§ã‚†ã£ãã‚Šå”±ãˆã¦ã‹ã‚‰å¼•ãã€‚åã¯ä½“ã‚’è¡¨ã—ã€ä½“ã¯ç¸ã‚’å¼•ãå¯„ã›ã‚‹ã€‚`);
    base.push(`ã€Œ${targetName}ã€ã®ã‚­ãƒ£ãƒ©ç”»åƒã‚’1åˆ†é–“è¦‹ã¤ã‚ã€ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ç„¼ãä»˜ã‘ã¦ã‹ã‚‰ã‚¬ãƒãƒ£ç”»é¢ã¸ã€‚è¦–è¦šçš„å¼•ãå¯„ã›ãŒåŠ¹æœã‚’é«˜ã‚ã‚‹ã€‚`);
  }
  if(gachaTitle) base.push(`ã€Œ${gachaTitle}ã€ã®ãƒãƒŠãƒ¼ç”»åƒã‚’ä¸€åº¦é–‰ã˜ã¦ã€å†åº¦é–‹ã„ãŸç¬é–“ã«å¼•ãã€‚å†èµ·å‹•ã§æ°—ãŒä¸€æ–°ã•ã‚Œã‚‹ã€‚`);
  base.push(`å¼•ãç›´å‰ã«ã‚¹ãƒãƒ›ã®å……é›»ã‚’ç¢ºèªã€‚é›»æ± æ®‹é‡ãŒ30%ä»¥ä¸Šã‚ã‚‹ã“ã¨ãŒé‹æ°—å®‰å®šã®æ¡ä»¶ã€‚`);
  return base;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//   DISPLAY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function displayResult(result) {
  const { score, gameTitle, targetName, gachaTitle, gachaDeadline, gachaDeadlineTime, luckyTimes, divinations, actions, moonPhase, kyusei, tarot, rokuyo, pulls } = result;

  // verdict
  const verdicts = [
    { min:90, label:'å¤§å‰ âœ¦ æœ€å¼·é–‹é‹', color:'#EDD070', borderColor:'rgba(237,208,112,.45)' },
    { min:80, label:'ä¸­å‰ âœ¦ å¥½é‹æ°—',   color:'#A78BFA', borderColor:'rgba(167,139,250,.4)' },
    { min:70, label:'å‰ âœ¦ è‰¯ãæµã‚Œ',   color:'#34D399', borderColor:'rgba(52,211,153,.35)' },
    { min:60, label:'å°å‰ âœ¦ å®‰å®š',      color:'#38BDF8', borderColor:'rgba(56,189,248,.3)' },
    { min: 0, label:'æœ«å‰ âœ¦ æ…é‡ã«',   color:'#94A3B8', borderColor:'rgba(148,163,184,.25)' }
  ];
  const verd = verdicts.find(v=>score>=v.min) || verdicts[verdicts.length-1];

  // score ring arc
  const C = 2*Math.PI*72;
  const arc = C * (score/100);
  const gap = C - arc;
  const stopColor1 = score>=80?'#A78BFA':'#38BDF8';

  let html = `
  <div class="glass score-hero">
    <div class="ring-wrap">
      <svg viewBox="0 0 160 160">
        <defs>
          <linearGradient id="rg" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%" stop-color="${stopColor1}"/>
            <stop offset="100%" stop-color="#C9A84C"/>
          </linearGradient>
        </defs>
        <circle cx="80" cy="80" r="72" fill="none" stroke="rgba(255,255,255,.05)" stroke-width="10"/>
        <circle cx="80" cy="80" r="72" fill="none" stroke="url(#rg)" stroke-width="10"
          stroke-dasharray="${arc.toFixed(2)} ${gap.toFixed(2)}" stroke-linecap="round"/>
      </svg>
      <div class="ring-inner">
        <div class="score-num">${score}</div>
        <div class="score-lbl">LUCKY</div>
      </div>
    </div>
    <div class="verdict-badge" style="color:${verd.color};border-color:${verd.borderColor}">${verd.label}</div><br>
    <div class="game-title-disp">${gameTitle}</div>
    ${gachaTitle ? `<div style="font-size:.82rem;color:var(--iris-l);margin:4px 0">ğŸ“‹ ${gachaTitle}</div>` : ''}
    ${gachaDeadline ? `<div style="font-size:.78rem;color:var(--danger);margin-top:4px">â° æœŸé™: ${new Date(gachaDeadline).getMonth()+1}æœˆ${new Date(gachaDeadline).getDate()}æ—¥ ${gachaDeadlineTime||'23:59'}ã¾ã§</div>` : ''}
    ${targetName ? `<div class="target-disp">âœ¦ ç‹™ã„: ${targetName}</div>` : ''}
    <div class="lunar-chip">
      <span>${moonPhase.icon}</span>
      <span>æœˆé½¢ ${getMoonAge(new Date().getTime()).age}æ—¥</span>
      <span class="lc-name">${moonPhase.name}</span>
      <span>${moonPhase.power}</span>
    </div>
    <div style="margin-top:12px;font-size:.78rem;color:var(--muted)">
      å…­æ›œ: <strong style="color:${rokuyo.bonus>=5?'var(--gold)':rokuyo.bonus<0?'var(--danger)':'var(--text)'}">${rokuyo.name}</strong>
      &emsp;ä»Šæ—¥ã®ã‚¿ãƒ­ãƒƒãƒˆ: <strong style="color:var(--iris-l)">${tarot.name}</strong>
      &emsp;ä¹æ˜Ÿ: <strong style="color:var(--text)">${kyusei.honmei}</strong>
    </div>
  </div>`;

  // lucky times
  html += `<p class="times-heading">âœ¦ æœ€é©ã‚¬ãƒãƒ£æ™‚åˆ» TOP ${luckyTimes.length} âœ¦</p>`;
  luckyTimes.forEach((t,i) => {
    const cls = i===0?'r1':i===1?'r2':i===2?'r3':'rlo';
    const barColor = t.score>=80?'var(--gold)':t.score>=70?'var(--iris-l)':'var(--ice)';
    html += `
    <div class="tc ${cls}${t.expired?' expired':''}">
      <span class="tc-rank-num">ç¬¬${t.rank}å€™è£œ</span>
      <div class="tc-top">
        <span class="tc-date">${t.date}ï¼ˆ${t.weekday}ï¼‰</span>
        <span class="tc-time">${t.time}</span>
        ${t.isLuckyDay?`<span class="badge b-special">â˜…ãƒ©ãƒƒã‚­ãƒ¼ãƒ‡ãƒ¼</span>`:''}
        ${t.urgent?`<span class="badge b-urgent">ğŸ”¥ç·Šæ€¥</span>`:''}
        ${t.special?`<span class="badge b-special">âœ¨ç‰¹åˆ¥</span>`:''}
        ${t.expired?`<span class="badge b-done">çµ‚äº†</span>`:''}
      </div>
      <div class="tc-pinpoint">ğŸ¯ æ¿€ã‚¢ãƒ„æ™‚åˆ»: ${t.pinpoint}</div>
      <div class="tc-bot">
        <div class="tc-pulls">ğŸ’ æ¨å¥¨ <strong>${t.tenPulls}</strong>é€£Ã—10</div>
        <div style="font-size:.7rem;color:var(--muted)">é‹æ°— ${t.score}pt</div>
        <div class="tc-bar">
          <div class="tc-bar-fill" style="width:${t.score}%;background:${barColor}"></div>
        </div>
      </div>
    </div>`;
  });

  // game occult
  const gdb = GAME_DB[gameTitle];
  if(gdb) {
    const icons = ['âš¡','ğŸŒŸ','ğŸ’','ğŸ”¥','âœ¨'];
    html += `
    <div class="glass" style="margin-top:8px">
      <p class="sec-title">ğŸ® ${gameTitle} ã‚ªã‚«ãƒ«ãƒˆæƒ…å ±</p>
      <div class="occult-box">
        <p class="occult-title">PLAYER FOLKLORE DATABASE</p>
        <p class="occult-sub">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼é–“ã§èªã‚Šç¶™ãŒã‚Œã‚‹éƒ½å¸‚ä¼èª¬ãƒ»ã‚¸ãƒ³ã‚¯ã‚¹é›†</p>
        ${gdb.jinxes.map((j,i)=>`<div class="jinx"><span class="jinx-ic">${icons[i%icons.length]}</span>${j}</div>`).join('')}
        <div style="font-size:.7rem;color:var(--muted);text-align:center;margin-top:12px;padding:10px;background:rgba(201,168,76,.06);border-radius:8px">
          ğŸ’¡ ä¸Šè¨˜ã‚¸ãƒ³ã‚¯ã‚¹ã¯å æ˜Ÿè¡“ã¨çµ„ã¿åˆã‚ã›ã€å€™è£œæ™‚åˆ»ã®é¸å®šã«åæ˜ æ¸ˆ
        </div>
      </div>
    </div>`;
  }

  // divinations
  html += `
  <div class="glass" style="margin-top:8px">
    <p class="sec-title">å…¨å è¡“ è©³ç´°é‘‘å®š</p>
    <div class="div-grid">`;

  divinations.forEach(d => {
    const pct = Math.min(100, d.score);
    html += `
    <div class="div-card">
      <div class="div-hdr">
        <span class="div-icon">${d.icon}</span>
        <span class="div-name">${d.name}</span>
        <span class="div-score">${d.score}pt</span>
      </div>
      <div class="div-bar"><div class="div-bar-fill" style="width:${pct}%;background:${d.color}"></div></div>
      <p class="div-body">${d.body}</p>
    </div>`;
  });

  html += `</div></div>`;

  // lucky actions
  html += `
  <div class="glass" style="margin-top:8px">
    <p class="sec-title">âœ¨ ã‚¬ãƒãƒ£å‰ãƒ©ãƒƒã‚­ãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</p>
    <ul class="action-list">
      ${actions.map((a,i)=>`
      <li class="action-item">
        <span class="action-num">${i+1}</span>
        <span>${a}</span>
      </li>`).join('')}
    </ul>
  </div>`;

  // pull summary
  html += `
  <div class="glass" style="background:rgba(201,168,76,.06);border-color:rgba(201,168,76,.22);margin-top:8px;text-align:center">
    <div style="font-family:'Cinzel',serif;font-size:.72rem;letter-spacing:.18em;color:var(--gold);margin-bottom:18px;text-transform:uppercase">æ¨å¥¨ã‚¬ãƒãƒ£å›æ•°ï¼ˆæœ¬æ—¥å…¨ä½“ï¼‰</div>
    <div style="display:flex;justify-content:center;gap:28px;flex-wrap:wrap">
      <div><div style="font-family:'Cinzel',serif;font-size:2rem;font-weight:700;color:var(--gold-l)">${pulls.ten}</div><div style="font-size:.7rem;color:var(--muted)">10é€£ æ¨å¥¨å›æ•°</div></div>
      <div><div style="font-family:'Cinzel',serif;font-size:2rem;font-weight:700;color:var(--iris-l)">${pulls.single}</div><div style="font-size:.7rem;color:var(--muted)">å˜ç™º æ¨å¥¨å›æ•°</div></div>
      <div><div style="font-family:'Cinzel',serif;font-size:2rem;font-weight:700;color:var(--text)">${pulls.total}</div><div style="font-size:.7rem;color:var(--muted)">åˆè¨ˆå¼•ãæ•°</div></div>
    </div>
  </div>`;

  // buttons
  html += `
  <button class="dl-btn" onclick="downloadImage()">ğŸ“¸ çµæœã‚’ç”»åƒã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
  <button class="rst-btn" onclick="resetFortune()">ğŸ”„ ãƒªã‚»ãƒƒãƒˆ â€” æ–°ã—ãå ã„ç›´ã™</button>`;

  document.getElementById('result').innerHTML = html;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//   IMAGE DOWNLOAD (Canvas)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function downloadImage() {
  const raw = localStorage.getItem('gachaOracle_result');
  if(!raw) { alert('å ã„çµæœãŒã‚ã‚Šã¾ã›ã‚“ã€‚'); return; }
  const r   = JSON.parse(raw);
  const cv  = document.createElement('canvas');
  cv.width  = 1080;
  cv.height = 320 + r.luckyTimes.length * 210;
  const ctx = cv.getContext('2d');

  // bg
  const bg = ctx.createLinearGradient(0,0,0,cv.height);
  bg.addColorStop(0,'#07040E'); bg.addColorStop(1,'#160C2E');
  ctx.fillStyle = bg; ctx.fillRect(0,0,cv.width,cv.height);

  // gold border top
  const gb = ctx.createLinearGradient(0,0,cv.width,0);
  gb.addColorStop(0,'transparent'); gb.addColorStop(.3,'#A78BFA'); gb.addColorStop(.6,'#C9A84C'); gb.addColorStop(1,'transparent');
  ctx.fillStyle = gb; ctx.fillRect(0,0,cv.width,3);

  // title
  ctx.textAlign='center';
  ctx.fillStyle='#C9A84C'; ctx.font='bold 36px serif';
  ctx.fillText('ğŸ”® GACHA ORACLE éœŠçœ¼çµ±åˆå è¡“', cv.width/2, 60);

  ctx.fillStyle='#EDE6F5'; ctx.font='bold 28px serif';
  ctx.fillText(r.gameTitle + (r.gachaTitle?` â€” ${r.gachaTitle}`:''), cv.width/2, 105);

  if(r.targetName) { ctx.fillStyle='#C9A84C'; ctx.font='22px serif'; ctx.fillText(`âœ¦ ç‹™ã„: ${r.targetName}`, cv.width/2, 140); }

  ctx.fillStyle='#A78BFA'; ctx.font='bold 26px serif';
  ctx.fillText(`ç·åˆé‹æ°—ã‚¹ã‚³ã‚¢: ${r.score}pt`, cv.width/2, 182);

  ctx.fillStyle='rgba(255,255,255,.15)'; ctx.fillRect(60,200,cv.width-120,2);

  let y = 240;
  r.luckyTimes.forEach((t,i) => {
    ctx.fillStyle = i===0?'rgba(201,168,76,.25)':i===1?'rgba(139,92,246,.15)':'rgba(255,255,255,.06)';
    ctx.beginPath(); ctx.roundRect(60,y-28,cv.width-120,180,12); ctx.fill();
    ctx.textAlign='left'; ctx.fillStyle='#C9A84C'; ctx.font='bold 22px serif';
    ctx.fillText(`ç¬¬${t.rank}å€™è£œ | ${t.date}ï¼ˆ${t.weekday}ï¼‰`, 90, y+10);
    ctx.fillStyle='#EDE6F5'; ctx.font='bold 28px serif';
    ctx.fillText(t.time, 90, y+50);
    ctx.fillStyle='#F87171'; ctx.font='bold 22px serif';
    ctx.fillText(`ğŸ¯ æ¿€ã‚¢ãƒ„: ${t.pinpoint}`, 90, y+85);
    ctx.textAlign='right'; ctx.fillStyle='#EDD070'; ctx.font='bold 26px serif';
    ctx.fillText(`ğŸ’ 10é€£ Ã— ${t.tenPulls}`, cv.width-90, y+50);
    ctx.fillStyle='#6E5F88'; ctx.font='18px serif';
    ctx.fillText(`é‹æ°— ${t.score}pt`, cv.width-90, y+90);
    ctx.textAlign='left';
    y += 210;
  });

  // footer
  ctx.fillStyle='rgba(255,255,255,.12)'; ctx.fillRect(60,y,cv.width-120,2);
  ctx.fillStyle='#6E5F88'; ctx.font='16px serif'; ctx.textAlign='center';
  ctx.fillText('Powered by ã‚¯ãƒˆã¡ã‚ƒã‚“ | éœŠçœ¼çµ±åˆå è¡“ã‚·ã‚¹ãƒ†ãƒ ', cv.width/2, y+30);

  const link = document.createElement('a');
  link.download = `GachaOracle_${r.gameTitle}_${new Date().toLocaleDateString('ja-JP')}.png`;
  link.href = cv.toDataURL(); link.click();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//   FORM HANDLING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.getElementById('gachaDeadline').min = new Date().toISOString().split('T')[0];

document.getElementById('gameTitle').addEventListener('change', function() {
  const show = this.value === 'ãã®ä»–';
  document.getElementById('customGameGroup').style.display = show ? 'block' : 'none';
  document.getElementById('customGame').required = show;
});

document.getElementById('fortuneForm').addEventListener('submit', function(e) {
  e.preventDefault();

  let gameTitle = document.getElementById('gameTitle').value;
  if(gameTitle === 'ãã®ä»–') gameTitle = document.getElementById('customGame').value;

  const params = {
    gameTitle,
    targetName:       document.getElementById('targetName').value,
    gachaTitle:       document.getElementById('gachaTitle').value,
    gachaDeadline:    document.getElementById('gachaDeadline').value,
    gachaDeadlineTime:document.getElementById('gachaDeadlineTime').value,
    birthdate:        document.getElementById('birthdate').value,
    zodiac:           document.getElementById('zodiac').value,
    bloodType:        document.getElementById('bloodType').value,
    eto:              document.getElementById('eto').value,
  };

  // loading
  const loading = document.getElementById('loading');
  const result  = document.getElementById('result');
  loading.classList.add('show');
  result.classList.remove('show');

  // step animation
  const steps = ['ls1','ls2','ls3','ls4','ls5'];
  steps.forEach((id,i) => setTimeout(() => document.getElementById(id)?.classList.add('lit'), i*360));

  setTimeout(() => {
    const data = calculateFortune(params);
    displayResult(data);
    loading.classList.remove('show');
    steps.forEach(id => document.getElementById(id)?.classList.remove('lit'));
    result.classList.add('show');
    result.scrollIntoView({ behavior:'smooth', block:'start' });
  }, 2100);
});

function resetFortune() {
  if(confirm('çµæœã‚’ãƒªã‚»ãƒƒãƒˆã—ã¦æ–°ã—ãå ã„ç›´ã—ã¾ã™ã‹ï¼Ÿ\nåŒã˜æ¡ä»¶ã§ã‚‚ç•°ãªã‚‹é‹å‹¢ãŒç®—å‡ºã•ã‚Œã¾ã™ã€‚')) {
    localStorage.removeItem('gachaOracle_result');
    localStorage.removeItem('gachaOracle_key');
    document.getElementById('result').classList.remove('show');
    window.scrollTo({top:0,behavior:'smooth'});
    alert('ãƒªã‚»ãƒƒãƒˆå®Œäº†ã€‚ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰å†å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
  }
}
</script>
</body>
</html>
